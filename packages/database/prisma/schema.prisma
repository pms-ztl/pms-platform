// PMS Enterprise Database Schema
// Multi-tenant architecture with row-level security

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema", "postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  // extensions = [pgcrypto, uuid_ossp]  // Disabled - using Prisma's uuid() instead
}

// ============================================================================
// TENANT & ORGANIZATION
// ============================================================================

model Tenant {
  id              String    @id @default(uuid()) @db.Uuid
  name            String
  slug            String    @unique
  domain          String?   @unique
  logoUrl         String?   @map("logo_url")
  primaryColor    String?   @map("primary_color")
  settings        Json      @default("{}")
  subscriptionTier String   @default("standard") @map("subscription_tier")
  maxUsers        Int       @default(100) @map("max_users")
  isActive        Boolean   @default(true) @map("is_active")
  dataRegion      String    @default("us-east-1") @map("data_region")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")

  // Relations
  users               User[]
  departments         Department[]
  businessUnits       BusinessUnit[]
  costCenters         CostCenter[]
  teams               Team[]
  roles               Role[]
  goals               Goal[]
  reviewCycles        ReviewCycle[]
  feedbackItems       Feedback[]
  calibrationSessions CalibrationSession[]
  auditEvents         AuditEvent[]
  integrations        Integration[]
  notificationTemplates NotificationTemplate[]
  competencyFrameworks CompetencyFramework[]
  reportingLines      ReportingLine[]
  delegations         Delegation[]
  accessPolicies      AccessPolicy[]
  unionContracts      UnionContract[]
  reportDefinitions   ReportDefinition[]
  generatedReports    GeneratedReport[]
  reportSchedules     ReportSchedule[]
  backgroundJobs      BackgroundJob[]
  dashboards          Dashboard[]
  widgets             Widget[]
  leaderboards        Leaderboard[]
  leaderboardEntries  LeaderboardEntry[]
  geographicPerformance GeographicPerformance[]
  notificationBoardItems NotificationBoardItem[]
  feedbackCycles      FeedbackCycle[]
  feedbackQuestionnaires FeedbackQuestionnaire[]
  feedbackNominations FeedbackNomination[]
  feedbackRequests    FeedbackRequest[]
  feedbackResponses   FeedbackResponse[]
  feedbackAggregations FeedbackAggregation[]
  feedbackGapAnalyses FeedbackGapAnalysis[]
  feedbackAccessControls FeedbackAccessControl[]
  technicalSkillAssessments TechnicalSkillAssessment[]
  skillCategories     SkillCategory[]
  projectEvaluations  ProjectEvaluation[]
  leadershipScores    LeadershipCompetencyScore[]
  behavioralScores    BehavioralCompetencyScore[]
  behavioralEvents    BehavioralTrackingEvent[]
  complianceAssessments ComplianceAssessment[]
  compliancePolicies  CompliancePolicy[]
  complianceViolations ComplianceViolation[]
  innovationContributions InnovationContribution[]
  assessmentCycles    AssessmentCycle[]
  sentimentAnalyses   SentimentAnalysis[]
  sentimentTrends     SentimentTrend[]
  productivityPredictions ProductivityPrediction[]
  productivityFeatures ProductivityFeature[]
  engagementScores    EngagementScore[]
  engagementEvents    EngagementEvent[]
  anomalyDetections   AnomalyDetection[]
  anomalyPatterns     AnomalyPattern[]
  performanceBenchmarks PerformanceBenchmark[]
  performanceComparisons PerformanceComparison[]
  mlModels            MLModel[]
  modelPredictions    ModelPrediction[]
  abTestExperiments   ABTestExperiment[]
  featureStore        FeatureStore[]
  promotionRecommendations PromotionRecommendation[]
  successionPlans     SuccessionPlan[]
  developmentPlans    DevelopmentPlan[]
  developmentActivities DevelopmentActivity[]
  developmentCheckpoints DevelopmentCheckpoint[]
  careerPaths         CareerPath[]
  teamOptimizations   TeamOptimization[]
  teamCompositionAnalyses TeamCompositionAnalysis[]
  performanceImprovementPlans PerformanceImprovementPlan[]
  pipCheckIns         PIPCheckIn[]
  pipMilestones       PIPMilestone[]
  pipTemplates        PIPTemplate[]
  organizationalHealthMetrics OrganizationalHealthMetrics[]
  departmentHealthMetrics DepartmentHealthMetrics[]
  cultureDiagnostics  CultureDiagnostic[]
  scenarioAnalyses    ScenarioAnalysis[]
  calendarEvents      CalendarEvent[]

  @@index([slug])
  @@index([domain])
  @@index([isActive])
  @@map("tenants")
}

model Department {
  id          String    @id @default(uuid()) @db.Uuid
  tenantId    String    @map("tenant_id") @db.Uuid
  parentId    String?   @map("parent_id") @db.Uuid
  name        String
  code        String
  description String?
  headId      String?   @map("head_id") @db.Uuid
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  // Relations
  tenant    Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  parent    Department? @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children  Department[] @relation("DepartmentHierarchy")
  head      User?       @relation("DepartmentHead", fields: [headId], references: [id])
  users     User[]      @relation("UserDepartment")
  teams     Team[]

  // Evaluation & Assessment Relations
  complianceAssessments ComplianceAssessment[] @relation("DepartmentComplianceAssessments")

  // Actionable Insights & Planning Relations
  healthMetrics         DepartmentHealthMetrics[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([parentId])
  @@map("departments")
}

// ============================================================================
// BUSINESS UNITS & COST CENTERS
// ============================================================================

model BusinessUnit {
  id          String    @id @default(uuid()) @db.Uuid
  tenantId    String    @map("tenant_id") @db.Uuid
  parentId    String?   @map("parent_id") @db.Uuid
  name        String
  code        String
  description String?
  headId      String?   @map("head_id") @db.Uuid
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  // Relations
  tenant    Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  parent    BusinessUnit?  @relation("BusinessUnitHierarchy", fields: [parentId], references: [id])
  children  BusinessUnit[] @relation("BusinessUnitHierarchy")
  head      User?          @relation("BusinessUnitHead", fields: [headId], references: [id])
  users     User[]         @relation("UserBusinessUnit")
  teams     Team[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([parentId])
  @@map("business_units")
}

model CostCenter {
  id          String    @id @default(uuid()) @db.Uuid
  tenantId    String    @map("tenant_id") @db.Uuid
  code        String
  name        String
  description String?
  managerId   String?   @map("manager_id") @db.Uuid
  budget      Float?
  currency    String    @default("USD")
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  // Relations
  tenant  Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  manager User?  @relation("CostCenterManager", fields: [managerId], references: [id])
  users   User[] @relation("UserCostCenter")
  teams   Team[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@map("cost_centers")
}

// ============================================================================
// TEAMS (Lateral Organization Structure)
// ============================================================================

enum TeamType {
  FUNCTIONAL      // Traditional department team
  CROSS_FUNCTIONAL // Cross-department project team
  VIRTUAL         // Temporary/ad-hoc team
  MATRIX          // Matrix organization team
}

model Team {
  id              String    @id @default(uuid()) @db.Uuid
  tenantId        String    @map("tenant_id") @db.Uuid
  name            String
  code            String
  description     String?
  type            TeamType  @default(FUNCTIONAL)
  departmentId    String?   @map("department_id") @db.Uuid
  businessUnitId  String?   @map("business_unit_id") @db.Uuid
  costCenterId    String?   @map("cost_center_id") @db.Uuid
  leadId          String?   @map("lead_id") @db.Uuid
  parentTeamId    String?   @map("parent_team_id") @db.Uuid
  isActive        Boolean   @default(true) @map("is_active")
  startDate       DateTime? @map("start_date")
  endDate         DateTime? @map("end_date")
  metadata        Json      @default("{}")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")

  // Relations
  tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  department    Department?   @relation(fields: [departmentId], references: [id])
  businessUnit  BusinessUnit? @relation(fields: [businessUnitId], references: [id])
  costCenter    CostCenter?   @relation(fields: [costCenterId], references: [id])
  lead          User?         @relation("TeamLead", fields: [leadId], references: [id])
  parentTeam    Team?         @relation("TeamHierarchy", fields: [parentTeamId], references: [id])
  childTeams    Team[]        @relation("TeamHierarchy")
  members       TeamMember[]
  goals         Goal[]        @relation("TeamGoals")

  // Real-Time Performance Tracking Relations
  milestones          ProjectMilestone[] @relation("TeamMilestones")
  performanceAlerts   PerformanceAlert[] @relation("TeamPerformanceAlerts")
  kpiValues           KpiValue[] @relation("TeamKpiValues")

  // Evaluation & Assessment Relations
  complianceAssessments ComplianceAssessment[] @relation("TeamComplianceAssessments")

  // Actionable Insights & Planning Relations
  compositionAnalyses   TeamCompositionAnalysis[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([departmentId])
  @@index([businessUnitId])
  @@index([leadId])
  @@index([type])
  @@map("teams")
}

enum TeamMemberRole {
  LEAD
  DEPUTY_LEAD
  MEMBER
  CONTRIBUTOR
  OBSERVER
}

model TeamMember {
  id            String         @id @default(uuid()) @db.Uuid
  teamId        String         @map("team_id") @db.Uuid
  userId        String         @map("user_id") @db.Uuid
  role          TeamMemberRole @default(MEMBER)
  allocation    Float          @default(100) // Percentage of time allocated
  startDate     DateTime       @default(now()) @map("start_date")
  endDate       DateTime?      @map("end_date")
  isPrimary     Boolean        @default(false) @map("is_primary") // Primary team for user
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")

  // Relations
  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@index([teamId])
  @@index([userId])
  @@index([role])
  @@map("team_members")
}

// ============================================================================
// MATRIX ORGANIZATION & DUAL REPORTING
// ============================================================================

enum ReportingLineType {
  SOLID           // Primary/direct reporting line
  DOTTED          // Secondary/functional reporting line
  MATRIX          // Matrix reporting (equal weight)
  PROJECT         // Project-based temporary reporting
}

model ReportingLine {
  id              String             @id @default(uuid()) @db.Uuid
  tenantId        String             @map("tenant_id") @db.Uuid
  reporterId      String             @map("reporter_id") @db.Uuid
  managerId       String             @map("manager_id") @db.Uuid
  type            ReportingLineType  @default(SOLID)
  weight          Float              @default(1) // For weighted reviews
  isPrimary       Boolean            @default(false) @map("is_primary")
  startDate       DateTime           @default(now()) @map("start_date")
  endDate         DateTime?          @map("end_date")
  notes           String?
  createdAt       DateTime           @default(now()) @map("created_at")
  updatedAt       DateTime           @updatedAt @map("updated_at")
  deletedAt       DateTime?          @map("deleted_at")

  // Relations
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  reporter User   @relation("ReporterLine", fields: [reporterId], references: [id], onDelete: Cascade)
  manager  User   @relation("ManagerLine", fields: [managerId], references: [id], onDelete: Cascade)

  @@unique([reporterId, managerId, type])
  @@index([tenantId])
  @@index([reporterId])
  @@index([managerId])
  @@index([type])
  @@map("reporting_lines")
}

// ============================================================================
// DELEGATION & ACTING ROLES
// ============================================================================

enum DelegationType {
  ACTING_MANAGER    // Temporary manager during absence
  PROXY_APPROVER    // Can approve on behalf of
  REVIEW_DELEGATE   // Can conduct reviews on behalf of
  FULL_DELEGATION   // Full authority delegation
}

enum DelegationStatus {
  PENDING
  ACTIVE
  EXPIRED
  REVOKED
}

model Delegation {
  id              String           @id @default(uuid()) @db.Uuid
  tenantId        String           @map("tenant_id") @db.Uuid
  delegatorId     String           @map("delegator_id") @db.Uuid
  delegateId      String           @map("delegate_id") @db.Uuid
  type            DelegationType
  status          DelegationStatus @default(PENDING)
  scope           Json             @default("{}") // What actions/resources are delegated
  reason          String?
  startDate       DateTime         @map("start_date")
  endDate         DateTime?        @map("end_date")
  approvedById    String?          @map("approved_by_id") @db.Uuid
  approvedAt      DateTime?        @map("approved_at")
  revokedById     String?          @map("revoked_by_id") @db.Uuid
  revokedAt       DateTime?        @map("revoked_at")
  revokeReason    String?          @map("revoke_reason")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")

  // Relations
  tenant     Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  delegator  User   @relation("Delegator", fields: [delegatorId], references: [id])
  delegate   User   @relation("Delegate", fields: [delegateId], references: [id])
  approvedBy User?  @relation("DelegationApprover", fields: [approvedById], references: [id])
  revokedBy  User?  @relation("DelegationRevoker", fields: [revokedById], references: [id])

  @@index([tenantId])
  @@index([delegatorId])
  @@index([delegateId])
  @@index([type])
  @@index([status])
  @@index([startDate, endDate])
  @@map("delegations")
}

// ============================================================================
// POLICY-DRIVEN VISIBILITY & ACCESS CONTROL
// ============================================================================

enum PolicyType {
  VISIBILITY      // Who can see what
  ACCESS          // Who can access what
  APPROVAL        // Approval workflows
  NOTIFICATION    // Who gets notified
  DATA_RETENTION  // Data retention rules
  UNION_CONTRACT  // Union/contract specific rules
}

enum PolicyStatus {
  DRAFT
  ACTIVE
  INACTIVE
  ARCHIVED
}

model AccessPolicy {
  id              String       @id @default(uuid()) @db.Uuid
  tenantId        String       @map("tenant_id") @db.Uuid
  name            String
  description     String?
  type            PolicyType
  status          PolicyStatus @default(DRAFT)
  priority        Int          @default(0) // Higher = evaluated first
  conditions      Json         @default("{}") // ABAC conditions
  actions         Json         @default("{}") // What the policy allows/denies
  effect          String       @default("ALLOW") // ALLOW or DENY
  targetRoles     String[]     @default([]) @map("target_roles")
  targetDepartments String[]   @default([]) @map("target_departments")
  targetTeams     String[]     @default([]) @map("target_teams")
  targetLevels    Int[]        @default([]) @map("target_levels")
  unionCode       String?      @map("union_code") // For union-specific policies
  contractType    String?      @map("contract_type") // For contract-specific policies
  effectiveFrom   DateTime?    @map("effective_from")
  effectiveTo     DateTime?    @map("effective_to")
  createdById     String       @map("created_by_id") @db.Uuid
  approvedById    String?      @map("approved_by_id") @db.Uuid
  approvedAt      DateTime?    @map("approved_at")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")
  deletedAt       DateTime?    @map("deleted_at")

  // Relations
  tenant     Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy  User   @relation("PolicyCreator", fields: [createdById], references: [id])
  approvedBy User?  @relation("PolicyApprover", fields: [approvedById], references: [id])

  @@index([tenantId])
  @@index([type])
  @@index([status])
  @@index([priority])
  @@index([unionCode])
  @@index([contractType])
  @@map("access_policies")
}

// ============================================================================
// UNION & CONTRACT RULES
// ============================================================================

model UnionContract {
  id              String    @id @default(uuid()) @db.Uuid
  tenantId        String    @map("tenant_id") @db.Uuid
  code            String
  name            String
  description     String?
  effectiveFrom   DateTime  @map("effective_from")
  effectiveTo     DateTime? @map("effective_to")
  rules           Json      @default("{}") // Contract-specific rules
  reviewRestrictions Json   @default("{}") @map("review_restrictions")
  feedbackRules   Json      @default("{}") @map("feedback_rules")
  calibrationRules Json     @default("{}") @map("calibration_rules")
  isActive        Boolean   @default(true) @map("is_active")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")

  // Relations
  tenant  Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  members UnionMembership[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([code])
  @@index([isActive])
  @@map("union_contracts")
}

model UnionMembership {
  id              String    @id @default(uuid()) @db.Uuid
  userId          String    @map("user_id") @db.Uuid
  unionContractId String    @map("union_contract_id") @db.Uuid
  membershipNumber String?  @map("membership_number")
  startDate       DateTime  @map("start_date")
  endDate         DateTime? @map("end_date")
  isActive        Boolean   @default(true) @map("is_active")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // Relations
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  unionContract UnionContract @relation(fields: [unionContractId], references: [id], onDelete: Cascade)

  @@unique([userId, unionContractId])
  @@index([userId])
  @@index([unionContractId])
  @@index([isActive])
  @@map("union_memberships")
}

// ============================================================================
// USERS & AUTHENTICATION
// ============================================================================

model User {
  id                String    @id @default(uuid()) @db.Uuid
  tenantId          String    @map("tenant_id") @db.Uuid
  externalId        String?   @map("external_id")
  email             String
  passwordHash      String?   @map("password_hash")
  firstName         String    @map("first_name")
  lastName          String    @map("last_name")
  displayName       String?   @map("display_name")
  avatarUrl         String?   @map("avatar_url")
  jobTitle          String?   @map("job_title")
  employeeNumber    String?   @map("employee_number")
  departmentId      String?   @map("department_id") @db.Uuid
  businessUnitId    String?   @map("business_unit_id") @db.Uuid
  costCenterId      String?   @map("cost_center_id") @db.Uuid
  managerId         String?   @map("manager_id") @db.Uuid
  level             Int       @default(1)
  hireDate          DateTime? @map("hire_date")
  timezone          String    @default("UTC")
  locale            String    @default("en-US")
  isActive          Boolean   @default(true) @map("is_active")
  lastLoginAt       DateTime? @map("last_login_at")
  mfaEnabled        Boolean   @default(false) @map("mfa_enabled")
  mfaSecret         String?   @map("mfa_secret")
  emailVerified     Boolean   @default(false) @map("email_verified")
  contractType      String?   @map("contract_type") // For union/contract rules
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  deletedAt         DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  department          Department?    @relation("UserDepartment", fields: [departmentId], references: [id])
  businessUnit        BusinessUnit?  @relation("UserBusinessUnit", fields: [businessUnitId], references: [id])
  costCenter          CostCenter?    @relation("UserCostCenter", fields: [costCenterId], references: [id])
  manager             User?          @relation("ManagerReports", fields: [managerId], references: [id])
  directReports       User[]         @relation("ManagerReports")
  departmentsHeaded   Department[]   @relation("DepartmentHead")
  businessUnitsHeaded BusinessUnit[] @relation("BusinessUnitHead")
  costCentersManaged  CostCenter[]   @relation("CostCenterManager")
  userRoles           UserRole[]
  sessions            Session[]

  // Team memberships
  teamMemberships     TeamMember[]
  teamsLed            Team[]         @relation("TeamLead")

  // Matrix reporting
  reportingLinesAsReporter ReportingLine[] @relation("ReporterLine")
  reportingLinesAsManager  ReportingLine[] @relation("ManagerLine")

  // Delegations
  delegationsGiven    Delegation[]   @relation("Delegator")
  delegationsReceived Delegation[]   @relation("Delegate")
  delegationsApproved Delegation[]   @relation("DelegationApprover")
  delegationsRevoked  Delegation[]   @relation("DelegationRevoker")

  // Access Policies
  policiesCreated     AccessPolicy[] @relation("PolicyCreator")
  policiesApproved    AccessPolicy[] @relation("PolicyApprover")

  // Union membership
  unionMemberships    UnionMembership[]

  // Goals
  ownedGoals          Goal[]       @relation("GoalOwner")
  createdGoals        Goal[]       @relation("GoalCreator")

  // Reviews
  reviewsAsReviewee   Review[]     @relation("ReviewReviewee")
  reviewsAsReviewer   Review[]     @relation("ReviewReviewer")

  // Feedback
  feedbackGiven       Feedback[]   @relation("FeedbackFrom")
  feedbackReceived    Feedback[]   @relation("FeedbackTo")
  feedbackRequested   Feedback[]   @relation("FeedbackRequester")

  // Calibration
  facilitatedCalibrations CalibrationSession[] @relation("CalibrationFacilitator")
  calibrationParticipations CalibrationParticipant[]
  calibrationRatings  CalibrationRating[]

  // 1-on-1s
  oneOnOnesAsManager  OneOnOne[]   @relation("OneOnOneManager")
  oneOnOnesAsEmployee OneOnOne[]   @relation("OneOnOneEmployee")

  // Audit
  auditEvents         AuditEvent[] @relation("AuditUser")

  // Notifications
  notifications       Notification[]

  // Evidence
  evidenceOwned       Evidence[]   @relation("EmployeeEvidence")
  evidenceVerified    Evidence[]   @relation("EvidenceVerifier")
  reviewEvidenceLinked ReviewEvidence[] @relation("ReviewEvidenceLinker")

  // Compensation Decisions
  compensationDecisions      CompensationDecision[] @relation("EmployeeCompensation")
  compensationProposals      CompensationDecision[] @relation("CompensationProposer")
  compensationApprovals      CompensationDecision[] @relation("CompensationApprover")
  compensationRejections     CompensationDecision[] @relation("CompensationRejecter")
  compensationImplementations CompensationDecision[] @relation("CompensationImplementer")

  // Promotion Decisions
  promotionDecisions         PromotionDecision[] @relation("EmployeePromotion")
  promotionNominations       PromotionDecision[] @relation("PromotionNominator")
  promotionReviews           PromotionDecision[] @relation("PromotionReviewer")
  promotionApprovals         PromotionDecision[] @relation("PromotionApprover")
  promotionRejections        PromotionDecision[] @relation("PromotionRejecter")
  promotionImplementations   PromotionDecision[] @relation("PromotionImplementer")

  // Decision Evidence Links
  decisionEvidenceLinked     DecisionEvidence[] @relation("DecisionEvidenceLinker")

  // Real-Time Performance Tracking Relations
  hourlyMetrics              HourlyPerformanceMetric[] @relation("UserHourlyMetrics")
  dailyMetrics               DailyPerformanceMetric[] @relation("UserDailyMetrics")
  activityEvents             ActivityEvent[] @relation("UserActivityEvents")
  performanceAnomalies       PerformanceAnomaly[] @relation("UserAnomalies")
  anomaliesAcknowledged      PerformanceAnomaly[] @relation("AnomalyAcknowledger")
  deadlineAlerts             DeadlineAlert[] @relation("UserDeadlineAlerts")
  workloadSnapshots          WorkloadSnapshot[] @relation("UserWorkloadSnapshots")
  sentimentAnalysis          CommunicationSentiment[] @relation("UserSentimentAnalysis")
  ownedMilestones            ProjectMilestone[] @relation("OwnedMilestones")
  milestoneEventsTriggered   MilestoneProgressEvent[] @relation("MilestoneEventTriggerer")
  performanceAlerts          PerformanceAlert[] @relation("UserPerformanceAlerts")
  alertsAcknowledged         PerformanceAlert[] @relation("AlertAcknowledger")
  kpiValues                  KpiValue[] @relation("UserKpiValues")

  // Periodic Analytics & Reporting Relations
  createdReportDefinitions   ReportDefinition[] @relation("ReportDefinitionCreator")
  generatedReports           GeneratedReport[] @relation("ReportGenerator")
  createdBackgroundJobs      BackgroundJob[] @relation("BackgroundJobCreator")
  ownedDashboards            Dashboard[] @relation("DashboardOwner")
  leaderboardEntries         LeaderboardEntry[] @relation("UserLeaderboardEntries")
  createdFeedbackCycles      FeedbackCycle[] @relation("FeedbackCycleCreator")
  createdQuestionnaires      FeedbackQuestionnaire[] @relation("QuestionnaireCreator")
  feedbackSubject            FeedbackNomination[] @relation("FeedbackSubject")
  feedbackReviewer           FeedbackNomination[] @relation("FeedbackReviewer")
  feedbackNominator          FeedbackNomination[] @relation("FeedbackNominator")
  nominationApprover         FeedbackNomination[] @relation("NominationApprover")
  requestSubject             FeedbackRequest[] @relation("RequestSubject")
  requestReviewer            FeedbackRequest[] @relation("RequestReviewer")
  responseSubject            FeedbackResponse[] @relation("ResponseSubject")
  responseReviewer           FeedbackResponse[] @relation("ResponseReviewer")
  aggregationSubject         FeedbackAggregation[] @relation("AggregationSubject")
  gapAnalysisSubject         FeedbackGapAnalysis[] @relation("GapAnalysisSubject")
  feedbackAccessUser         FeedbackAccessControl[] @relation("FeedbackAccessUser")
  accessGrantor              FeedbackAccessControl[] @relation("AccessGrantor")

  // Evaluation & Assessment Relations
  technicalSkills            TechnicalSkillAssessment[] @relation("UserTechnicalSkills")
  skillAssessments           SkillProgressHistory[] @relation("SkillAssessor")
  projectEvaluationsAsEvaluator ProjectEvaluation[] @relation("ProjectEvaluator")
  projectContributions       ProjectContributionScore[] @relation("UserProjectContributions")
  leadershipScores           LeadershipCompetencyScore[] @relation("UserLeadershipScores")
  behavioralScores           BehavioralCompetencyScore[] @relation("UserBehavioralScores")
  behavioralEvents           BehavioralTrackingEvent[] @relation("UserBehavioralEvents")
  complianceAssessments      ComplianceAssessment[] @relation("UserComplianceAssessments")
  complianceAssessor         ComplianceAssessment[] @relation("ComplianceAssessor")
  complianceRemediator       ComplianceAssessment[] @relation("ComplianceRemediator")
  complianceViolations       ComplianceViolation[] @relation("ViolationUser")
  violationsAcknowledged     ComplianceViolation[] @relation("ViolationAcknowledger")
  violationsResolved         ComplianceViolation[] @relation("ViolationResolver")
  policiesCreatedCompliance  CompliancePolicy[] @relation("PolicyCreator")
  policiesApprovedCompliance CompliancePolicy[] @relation("PolicyApprover")
  innovationContributions    InnovationContribution[] @relation("InnovationContributor")
  innovationReviews          InnovationContribution[] @relation("InnovationReviewer")
  innovationEvaluations      InnovationEvaluation[] @relation("InnovationEvaluator")
  assessmentCyclesCreated    AssessmentCycle[] @relation("CycleCreator")

  // AI-Driven Insights Relations
  sentimentAnalyses          SentimentAnalysis[] @relation("UserSentimentAnalysis")
  sentimentTrends            SentimentTrend[] @relation("UserSentimentTrends")
  engagementScores           EngagementScore[] @relation("UserEngagementScores")
  engagementEvents           EngagementEvent[] @relation("UserEngagementEvents")
  performanceComparisons     PerformanceComparison[] @relation("UserPerformanceComparisons")
  anomaliesAcknowledged2     AnomalyDetection[] @relation("AnomalyAcknowledger2")
  mlModelsCreated            MLModel[] @relation("MLModelCreator")
  abTestsCreated             ABTestExperiment[] @relation("ABTestCreator")

  // Actionable Insights & Planning Relations
  promotionRecommendations   PromotionRecommendation[] @relation("UserPromotionRecommendations")
  developmentPlans           DevelopmentPlan[] @relation("UserDevelopmentPlans")
  developmentActivities      DevelopmentActivity[] @relation("UserDevelopmentActivities")
  developmentCheckpoints     DevelopmentCheckpoint[] @relation("UserDevelopmentCheckpoints")
  performanceImprovementPlans PerformanceImprovementPlan[] @relation("UserPIPs")
  pipCheckIns                PIPCheckIn[] @relation("UserPIPCheckIns")

  // Calendar Events
  calendarEvents             CalendarEvent[] @relation("UserCalendarEvents")

  @@unique([tenantId, email])
  @@unique([tenantId, employeeNumber])
  @@index([tenantId])
  @@index([managerId])
  @@index([departmentId])
  @@index([businessUnitId])
  @@index([costCenterId])
  @@index([isActive])
  @@map("users")
}

model Session {
  id           String   @id @default(uuid()) @db.Uuid
  userId       String   @map("user_id") @db.Uuid
  token        String   @unique
  refreshToken String?  @unique @map("refresh_token")
  userAgent    String?  @map("user_agent")
  ipAddress    String?  @map("ip_address")
  expiresAt    DateTime @map("expires_at")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("sessions")
}

// ============================================================================
// ROLES & PERMISSIONS (RBAC + ABAC)
// ============================================================================

model Role {
  id          String    @id @default(uuid()) @db.Uuid
  tenantId    String    @map("tenant_id") @db.Uuid
  name        String
  description String?
  isSystem    Boolean   @default(false) @map("is_system")
  permissions Json      @default("[]")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  // Relations
  tenant    Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  userRoles UserRole[]

  // Promotion role changes
  promotionsPreviousRole PromotionDecision[] @relation("PreviousRole")
  promotionsNewRole      PromotionDecision[] @relation("NewRole")

  @@unique([tenantId, name])
  @@index([tenantId])
  @@map("roles")
}

model UserRole {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  roleId    String   @map("role_id") @db.Uuid
  grantedAt DateTime @default(now()) @map("granted_at")
  grantedBy String?  @map("granted_by") @db.Uuid
  expiresAt DateTime? @map("expires_at")

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
  @@map("user_roles")
}

// ============================================================================
// GOALS & OKRs
// ============================================================================

enum GoalType {
  INDIVIDUAL
  TEAM
  DEPARTMENT
  COMPANY
  OKR_OBJECTIVE
  OKR_KEY_RESULT
}

enum GoalStatus {
  DRAFT
  ACTIVE
  COMPLETED
  CANCELLED
  ON_HOLD
}

enum GoalPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum CalendarEventType {
  MEETING
  DEADLINE
  REMINDER
  PERSONAL
  GOAL_RELATED
  REVIEW_RELATED
}

model Goal {
  id              String       @id @default(uuid()) @db.Uuid
  tenantId        String       @map("tenant_id") @db.Uuid
  ownerId         String       @map("owner_id") @db.Uuid
  createdById     String       @map("created_by_id") @db.Uuid
  parentGoalId    String?      @map("parent_goal_id") @db.Uuid
  teamId          String?      @map("team_id") @db.Uuid
  type            GoalType     @default(INDIVIDUAL)
  title           String
  description     String?
  status          GoalStatus   @default(DRAFT)
  priority        GoalPriority @default(MEDIUM)
  progress        Float        @default(0)
  targetValue     Float?       @map("target_value")
  currentValue    Float?       @map("current_value")
  unit            String?
  startDate       DateTime?    @map("start_date")
  dueDate         DateTime?    @map("due_date")
  completedAt     DateTime?    @map("completed_at")
  weight          Float        @default(1)
  isPrivate       Boolean      @default(false) @map("is_private")
  tags            String[]     @default([])
  metadata        Json         @default("{}")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")
  deletedAt       DateTime?    @map("deleted_at")

  // Relations
  tenant          Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  owner           User          @relation("GoalOwner", fields: [ownerId], references: [id])
  createdBy       User          @relation("GoalCreator", fields: [createdById], references: [id])
  parentGoal      Goal?         @relation("GoalHierarchy", fields: [parentGoalId], references: [id])
  childGoals      Goal[]        @relation("GoalHierarchy")
  team            Team?         @relation("TeamGoals", fields: [teamId], references: [id])
  alignments      GoalAlignment[] @relation("AlignedFrom")
  alignedToThis   GoalAlignment[] @relation("AlignedTo")
  progressUpdates GoalProgressUpdate[]
  comments        GoalComment[]
  reviewGoals     ReviewGoal[]

  // Real-Time Performance Tracking Relations
  milestones      ProjectMilestone[] @relation("GoalMilestones")

  // Evaluation & Assessment Relations
  projectEvaluations ProjectEvaluation[] @relation("GoalProjectEvaluations")

  // Calendar Events
  calendarEvents     CalendarEvent[] @relation("GoalCalendarEvents")

  @@index([tenantId])
  @@index([ownerId])
  @@index([parentGoalId])
  @@index([teamId])
  @@index([status])
  @@index([type])
  @@index([dueDate])
  @@map("goals")
}

model GoalAlignment {
  id              String   @id @default(uuid()) @db.Uuid
  fromGoalId      String   @map("from_goal_id") @db.Uuid
  toGoalId        String   @map("to_goal_id") @db.Uuid
  alignmentType   String   @default("supports") @map("alignment_type")
  contributionWeight Float @default(1) @map("contribution_weight")
  createdAt       DateTime @default(now()) @map("created_at")

  // Relations
  fromGoal Goal @relation("AlignedFrom", fields: [fromGoalId], references: [id], onDelete: Cascade)
  toGoal   Goal @relation("AlignedTo", fields: [toGoalId], references: [id], onDelete: Cascade)

  @@unique([fromGoalId, toGoalId])
  @@index([fromGoalId])
  @@index([toGoalId])
  @@map("goal_alignments")
}

model GoalProgressUpdate {
  id          String   @id @default(uuid()) @db.Uuid
  goalId      String   @map("goal_id") @db.Uuid
  previousProgress Float @map("previous_progress")
  newProgress Float    @map("new_progress")
  previousValue Float? @map("previous_value")
  newValue    Float?   @map("new_value")
  note        String?
  updatedById String   @map("updated_by_id") @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at")

  // Relations
  goal Goal @relation(fields: [goalId], references: [id], onDelete: Cascade)

  @@index([goalId])
  @@index([createdAt])
  @@map("goal_progress_updates")
}

model GoalComment {
  id        String   @id @default(uuid()) @db.Uuid
  goalId    String   @map("goal_id") @db.Uuid
  authorId  String   @map("author_id") @db.Uuid
  content   String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  // Relations
  goal Goal @relation(fields: [goalId], references: [id], onDelete: Cascade)

  @@index([goalId])
  @@map("goal_comments")
}

// ============================================================================
// CALENDAR EVENTS
// ============================================================================

model CalendarEvent {
  id                String            @id @default(uuid()) @db.Uuid
  tenantId          String            @map("tenant_id") @db.Uuid
  userId            String            @map("user_id") @db.Uuid
  title             String
  description       String?
  eventDate         DateTime          @map("event_date")
  startTime         DateTime?         @map("start_time")
  endTime           DateTime?         @map("end_time")
  allDay            Boolean           @default(false) @map("all_day")
  type              CalendarEventType @default(PERSONAL)
  color             String?
  recurrenceRule    String?           @map("recurrence_rule")
  recurrenceEndDate DateTime?         @map("recurrence_end_date")
  parentEventId     String?           @map("parent_event_id") @db.Uuid
  reminderMinutes   Int[]             @default([]) @map("reminder_minutes")
  goalId            String?           @map("goal_id") @db.Uuid
  reviewCycleId     String?           @map("review_cycle_id") @db.Uuid
  metadata          Json              @default("{}")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  deletedAt         DateTime?         @map("deleted_at")

  // Relations
  tenant       Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user         User            @relation("UserCalendarEvents", fields: [userId], references: [id])
  parentEvent  CalendarEvent?  @relation("RecurrenceInstances", fields: [parentEventId], references: [id])
  childEvents  CalendarEvent[] @relation("RecurrenceInstances")
  goal         Goal?           @relation("GoalCalendarEvents", fields: [goalId], references: [id])
  reviewCycle  ReviewCycle?    @relation("ReviewCycleCalendarEvents", fields: [reviewCycleId], references: [id])

  @@index([tenantId])
  @@index([userId])
  @@index([eventDate])
  @@index([goalId])
  @@index([reviewCycleId])
  @@map("calendar_events")
}

// ============================================================================
// REVIEW CYCLES & REVIEWS
// ============================================================================

enum ReviewCycleStatus {
  DRAFT
  SCHEDULED
  SELF_ASSESSMENT
  MANAGER_REVIEW
  CALIBRATION
  FINALIZATION
  SHARING
  COMPLETED
  CANCELLED
}

enum ReviewCycleType {
  ANNUAL
  SEMI_ANNUAL
  QUARTERLY
  PROBATION
  PROJECT
  AD_HOC
}

model ReviewCycle {
  id                String            @id @default(uuid()) @db.Uuid
  tenantId          String            @map("tenant_id") @db.Uuid
  name              String
  description       String?
  type              ReviewCycleType   @default(ANNUAL)
  status            ReviewCycleStatus @default(DRAFT)
  startDate         DateTime          @map("start_date")
  endDate           DateTime          @map("end_date")
  selfAssessmentStart DateTime?       @map("self_assessment_start")
  selfAssessmentEnd DateTime?         @map("self_assessment_end")
  managerReviewStart DateTime?        @map("manager_review_start")
  managerReviewEnd  DateTime?         @map("manager_review_end")
  calibrationStart  DateTime?         @map("calibration_start")
  calibrationEnd    DateTime?         @map("calibration_end")
  sharingStart      DateTime?         @map("sharing_start")
  includeGoals      Boolean           @default(true) @map("include_goals")
  includeFeedback   Boolean           @default(true) @map("include_feedback")
  include360        Boolean           @default(false) @map("include_360")
  requireAcknowledgment Boolean       @default(true) @map("require_acknowledgment")
  templateId        String?           @map("template_id") @db.Uuid
  settings          Json              @default("{}")
  createdById       String            @map("created_by_id") @db.Uuid
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  deletedAt         DateTime?         @map("deleted_at")

  // Relations
  tenant              Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  template            ReviewTemplate?     @relation(fields: [templateId], references: [id])
  reviews             Review[]
  calibrationSessions CalibrationSession[]
  compensationDecisions CompensationDecision[]
  promotionDecisions  PromotionDecision[]
  calendarEvents      CalendarEvent[] @relation("ReviewCycleCalendarEvents")

  @@index([tenantId])
  @@index([status])
  @@index([startDate, endDate])
  @@map("review_cycles")
}

model ReviewTemplate {
  id          String   @id @default(uuid()) @db.Uuid
  tenantId    String   @map("tenant_id") @db.Uuid
  name        String
  description String?
  isDefault   Boolean  @default(false) @map("is_default")
  sections    Json     @default("[]")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  // Relations
  reviewCycles ReviewCycle[]

  @@index([tenantId])
  @@map("review_templates")
}

enum ReviewStatus {
  NOT_STARTED
  IN_PROGRESS
  SUBMITTED
  CALIBRATED
  FINALIZED
  ACKNOWLEDGED
}

enum ReviewType {
  SELF
  MANAGER
  PEER
  UPWARD
  EXTERNAL
  THREE_SIXTY
}

model Review {
  id              String       @id @default(uuid()) @db.Uuid
  tenantId        String       @map("tenant_id") @db.Uuid
  cycleId         String       @map("cycle_id") @db.Uuid
  revieweeId      String       @map("reviewee_id") @db.Uuid
  reviewerId      String       @map("reviewer_id") @db.Uuid
  type            ReviewType
  status          ReviewStatus @default(NOT_STARTED)
  overallRating   Float?       @map("overall_rating")
  calibratedRating Float?      @map("calibrated_rating")
  content         Json         @default("{}")
  strengths       String[]     @default([])
  areasForGrowth  String[]     @default([]) @map("areas_for_growth")
  summary         String?
  privateNotes    String?      @map("private_notes")
  submittedAt     DateTime?    @map("submitted_at")
  calibratedAt    DateTime?    @map("calibrated_at")
  finalizedAt     DateTime?    @map("finalized_at")
  acknowledgedAt  DateTime?    @map("acknowledged_at")
  sharedAt        DateTime?    @map("shared_at")
  biasScore       Float?       @map("bias_score")
  biasFlags       Json         @default("[]") @map("bias_flags")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")
  deletedAt       DateTime?    @map("deleted_at")

  // Relations
  cycle           ReviewCycle @relation(fields: [cycleId], references: [id], onDelete: Cascade)
  reviewee        User        @relation("ReviewReviewee", fields: [revieweeId], references: [id])
  reviewer        User        @relation("ReviewReviewer", fields: [reviewerId], references: [id])
  reviewGoals     ReviewGoal[]
  calibrationRatings CalibrationRating[]
  evidenceLinks   ReviewEvidence[]

  @@unique([cycleId, revieweeId, reviewerId, type])
  @@index([tenantId])
  @@index([cycleId])
  @@index([revieweeId])
  @@index([reviewerId])
  @@index([status])
  @@map("reviews")
}

model ReviewGoal {
  id              String  @id @default(uuid()) @db.Uuid
  reviewId        String  @map("review_id") @db.Uuid
  goalId          String  @map("goal_id") @db.Uuid
  rating          Float?
  comment         String?
  achievementPercentage Float? @map("achievement_percentage")

  // Relations
  review Review @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  goal   Goal   @relation(fields: [goalId], references: [id])

  @@unique([reviewId, goalId])
  @@index([reviewId])
  @@index([goalId])
  @@map("review_goals")
}

// ============================================================================
// CONTINUOUS FEEDBACK
// ============================================================================

enum FeedbackType {
  PRAISE
  CONSTRUCTIVE
  SUGGESTION
  REQUEST
  RECOGNITION
}

enum FeedbackVisibility {
  PRIVATE
  MANAGER_VISIBLE
  PUBLIC
}

model Feedback {
  id            String             @id @default(uuid()) @db.Uuid
  tenantId      String             @map("tenant_id") @db.Uuid
  fromUserId    String             @map("from_user_id") @db.Uuid
  toUserId      String             @map("to_user_id") @db.Uuid
  requestedById String?            @map("requested_by_id") @db.Uuid
  type          FeedbackType
  visibility    FeedbackVisibility @default(PRIVATE)
  content       String
  isAnonymous   Boolean            @default(false) @map("is_anonymous")
  tags          String[]           @default([])
  valueTags     String[]           @default([]) @map("value_tags")
  skillTags     String[]           @default([]) @map("skill_tags")
  sentiment     String?
  sentimentScore Float?            @map("sentiment_score")
  aiCategory    String?            @map("ai_category")
  isAcknowledged Boolean           @default(false) @map("is_acknowledged")
  acknowledgedAt DateTime?         @map("acknowledged_at")
  createdAt     DateTime           @default(now()) @map("created_at")
  updatedAt     DateTime           @updatedAt @map("updated_at")
  deletedAt     DateTime?          @map("deleted_at")

  // Relations
  tenant      Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  fromUser    User   @relation("FeedbackFrom", fields: [fromUserId], references: [id])
  toUser      User   @relation("FeedbackTo", fields: [toUserId], references: [id])
  requestedBy User?  @relation("FeedbackRequester", fields: [requestedById], references: [id])

  @@index([tenantId])
  @@index([fromUserId])
  @@index([toUserId])
  @@index([type])
  @@index([visibility])
  @@index([createdAt])
  @@map("feedback")
}

// ============================================================================
// CALIBRATION
// ============================================================================

enum CalibrationStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model CalibrationSession {
  id              String            @id @default(uuid()) @db.Uuid
  tenantId        String            @map("tenant_id") @db.Uuid
  cycleId         String            @map("cycle_id") @db.Uuid
  name            String
  description     String?
  facilitatorId   String            @map("facilitator_id") @db.Uuid
  status          CalibrationStatus @default(SCHEDULED)
  scheduledStart  DateTime          @map("scheduled_start")
  scheduledEnd    DateTime?         @map("scheduled_end")
  actualStart     DateTime?         @map("actual_start")
  actualEnd       DateTime?         @map("actual_end")
  departmentScope String[]          @default([]) @map("department_scope")
  levelScope      Int[]             @default([]) @map("level_scope")
  preAnalysis     Json              @default("{}") @map("pre_analysis")
  outliers        Json              @default("[]")
  biasAlerts      Json              @default("[]") @map("bias_alerts")
  notes           String?
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  deletedAt       DateTime?         @map("deleted_at")

  // Relations
  tenant          Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  cycle           ReviewCycle             @relation(fields: [cycleId], references: [id])
  facilitator     User                    @relation("CalibrationFacilitator", fields: [facilitatorId], references: [id])
  participants    CalibrationParticipant[]
  ratings         CalibrationRating[]
  promotionDecisions PromotionDecision[]

  @@index([tenantId])
  @@index([cycleId])
  @@index([status])
  @@index([scheduledStart])
  @@map("calibration_sessions")
}

model CalibrationParticipant {
  id          String   @id @default(uuid()) @db.Uuid
  sessionId   String   @map("session_id") @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  role        String   @default("participant")
  joinedAt    DateTime? @map("joined_at")
  leftAt      DateTime? @map("left_at")

  // Relations
  session CalibrationSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user    User               @relation(fields: [userId], references: [id])

  @@unique([sessionId, userId])
  @@index([sessionId])
  @@index([userId])
  @@map("calibration_participants")
}

model CalibrationRating {
  id              String   @id @default(uuid()) @db.Uuid
  sessionId       String   @map("session_id") @db.Uuid
  reviewId        String   @map("review_id") @db.Uuid
  adjustedById    String   @map("adjusted_by_id") @db.Uuid
  originalRating  Float    @map("original_rating")
  adjustedRating  Float    @map("adjusted_rating")
  rationale       String
  discussionNotes String?  @map("discussion_notes")
  createdAt       DateTime @default(now()) @map("created_at")

  // Relations
  session    CalibrationSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  review     Review             @relation(fields: [reviewId], references: [id])
  adjustedBy User               @relation(fields: [adjustedById], references: [id])

  @@index([sessionId])
  @@index([reviewId])
  @@map("calibration_ratings")
}

// ============================================================================
// 1-ON-1 MEETINGS
// ============================================================================

enum OneOnOneStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model OneOnOne {
  id              String         @id @default(uuid()) @db.Uuid
  tenantId        String         @map("tenant_id") @db.Uuid
  managerId       String         @map("manager_id") @db.Uuid
  employeeId      String         @map("employee_id") @db.Uuid
  status          OneOnOneStatus @default(SCHEDULED)
  scheduledAt     DateTime       @map("scheduled_at")
  duration        Int            @default(30)
  location        String?
  meetingLink     String?        @map("meeting_link")
  agenda          Json           @default("[]")
  managerNotes    String?        @map("manager_notes")
  employeeNotes   String?        @map("employee_notes")
  sharedNotes     String?        @map("shared_notes")
  actionItems     Json           @default("[]") @map("action_items")
  completedAt     DateTime?      @map("completed_at")
  calendarEventId String?        @map("calendar_event_id")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  deletedAt       DateTime?      @map("deleted_at")

  // Relations
  manager  User @relation("OneOnOneManager", fields: [managerId], references: [id])
  employee User @relation("OneOnOneEmployee", fields: [employeeId], references: [id])

  @@index([tenantId])
  @@index([managerId])
  @@index([employeeId])
  @@index([scheduledAt])
  @@map("one_on_ones")
}

// ============================================================================
// COMPETENCY FRAMEWORKS
// ============================================================================

model CompetencyFramework {
  id          String   @id @default(uuid()) @db.Uuid
  tenantId    String   @map("tenant_id") @db.Uuid
  name        String
  description String?
  isDefault   Boolean  @default(false) @map("is_default")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  // Relations
  tenant       Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  competencies Competency[]

  @@index([tenantId])
  @@map("competency_frameworks")
}

model Competency {
  id           String   @id @default(uuid()) @db.Uuid
  frameworkId  String   @map("framework_id") @db.Uuid
  parentId     String?  @map("parent_id") @db.Uuid
  name         String
  description  String?
  category     String?
  levelDescriptions Json @default("{}") @map("level_descriptions")
  sortOrder    Int      @default(0) @map("sort_order")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  framework  CompetencyFramework @relation(fields: [frameworkId], references: [id], onDelete: Cascade)
  parent     Competency?         @relation("CompetencyHierarchy", fields: [parentId], references: [id])
  children   Competency[]        @relation("CompetencyHierarchy")

  @@index([frameworkId])
  @@index([parentId])
  @@map("competencies")
}

// ============================================================================
// INTEGRATIONS
// ============================================================================

enum IntegrationStatus {
  ACTIVE
  INACTIVE
  ERROR
  PENDING_AUTH
}

model Integration {
  id              String            @id @default(uuid()) @db.Uuid
  tenantId        String            @map("tenant_id") @db.Uuid
  type            String
  name            String
  status          IntegrationStatus @default(PENDING_AUTH)
  config          Json              @default("{}")
  credentials     Json              @default("{}")
  lastSyncAt      DateTime?         @map("last_sync_at")
  lastError       String?           @map("last_error")
  syncFrequency   String            @default("daily") @map("sync_frequency")
  fieldMappings   Json              @default("{}") @map("field_mappings")
  createdById     String            @map("created_by_id") @db.Uuid
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  deletedAt       DateTime?         @map("deleted_at")

  // Relations
  tenant    Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  syncJobs  IntegrationSyncJob[]

  @@index([tenantId])
  @@index([type])
  @@index([status])
  @@map("integrations")
}

enum SyncJobStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
}

model IntegrationSyncJob {
  id            String        @id @default(uuid()) @db.Uuid
  integrationId String        @map("integration_id") @db.Uuid
  status        SyncJobStatus @default(PENDING)
  direction     String        @default("inbound")
  recordsProcessed Int        @default(0) @map("records_processed")
  recordsFailed Int           @default(0) @map("records_failed")
  errorLog      Json          @default("[]") @map("error_log")
  startedAt     DateTime?     @map("started_at")
  completedAt   DateTime?     @map("completed_at")
  createdAt     DateTime      @default(now()) @map("created_at")

  // Relations
  integration Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)

  @@index([integrationId])
  @@index([status])
  @@index([createdAt])
  @@map("integration_sync_jobs")
}

// ============================================================================
// NOTIFICATIONS
// ============================================================================

model NotificationTemplate {
  id          String   @id @default(uuid()) @db.Uuid
  tenantId    String   @map("tenant_id") @db.Uuid
  type        String
  name        String
  subject     String?
  bodyHtml    String?  @map("body_html")
  bodyText    String?  @map("body_text")
  channels    String[] @default(["email"])
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, type])
  @@index([tenantId])
  @@map("notification_templates")
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
  READ
}

model Notification {
  id          String             @id @default(uuid()) @db.Uuid
  userId      String             @map("user_id") @db.Uuid
  type        String
  title       String
  body        String
  data        Json               @default("{}")
  channel     String             @default("in_app")
  status      NotificationStatus @default(PENDING)
  sentAt      DateTime?          @map("sent_at")
  readAt      DateTime?          @map("read_at")
  createdAt   DateTime           @default(now()) @map("created_at")

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@map("notifications")
}

// ============================================================================
// EVIDENCE & PERFORMANCE ARTIFACTS (First-Class Entities)
// ============================================================================

enum EvidenceType {
  TASK
  TICKET
  PULL_REQUEST
  CODE_COMMIT
  DOCUMENT
  PRESENTATION
  DESIGN
  PROJECT_MILESTONE
  CUSTOMER_FEEDBACK
  INCIDENT_RESOLUTION
  MENTORSHIP_SESSION
  TRAINING_COMPLETION
  CERTIFICATION
  MEETING_FACILITATION
  PROCESS_IMPROVEMENT
  RECOGNITION_RECEIVED
  COLLABORATION_CONTRIBUTION
  KNOWLEDGE_SHARING
  PEER_FEEDBACK
  MANAGER_OBSERVATION
  SELF_ASSESSMENT
  METRIC_ACHIEVEMENT
}

enum EvidenceSource {
  JIRA
  GITHUB
  GITLAB
  AZURE_DEVOPS
  CONFLUENCE
  NOTION
  GOOGLE_DOCS
  SLACK
  TEAMS
  SALESFORCE
  ZENDESK
  BAMBOO_HR
  WORKDAY
  MANUAL
  API_IMPORT
  INTERNAL
}

enum EvidenceStatus {
  PENDING_VERIFICATION
  VERIFIED
  DISPUTED
  REJECTED
  ARCHIVED
}

model Evidence {
  id              String           @id @default(uuid()) @db.Uuid
  tenantId        String           @map("tenant_id") @db.Uuid
  employeeId      String           @map("employee_id") @db.Uuid
  type            EvidenceType
  source          EvidenceSource   @default(MANUAL)
  status          EvidenceStatus   @default(PENDING_VERIFICATION)
  title           String
  description     String?
  externalId      String?          @map("external_id")
  externalUrl     String?          @map("external_url")
  occurredAt      DateTime         @map("occurred_at")

  // Metrics
  impactScore     Float?           @map("impact_score")
  effortScore     Float?           @map("effort_score")
  qualityScore    Float?           @map("quality_score")
  complexityScore Float?           @map("complexity_score")
  collaborators   String[]         @default([])

  // Verification
  verifiedById    String?          @map("verified_by_id") @db.Uuid
  verifiedAt      DateTime?        @map("verified_at")
  verificationNotes String?        @map("verification_notes")

  // Metadata
  tags            String[]         @default([])
  skillTags       String[]         @default([]) @map("skill_tags")
  valueTags       String[]         @default([]) @map("value_tags")
  metadata        Json             @default("{}")

  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  deletedAt       DateTime?        @map("deleted_at")

  // Relations
  employee        User             @relation("EmployeeEvidence", fields: [employeeId], references: [id])
  verifiedBy      User?            @relation("EvidenceVerifier", fields: [verifiedById], references: [id])
  reviewLinks     ReviewEvidence[]
  decisionLinks   DecisionEvidence[]

  @@index([tenantId])
  @@index([employeeId])
  @@index([type])
  @@index([source])
  @@index([status])
  @@index([occurredAt])
  @@index([tenantId, employeeId, occurredAt])
  @@map("evidence")
}

// Link table: Evidence to Reviews (many-to-many with context)
model ReviewEvidence {
  id              String   @id @default(uuid()) @db.Uuid
  reviewId        String   @map("review_id") @db.Uuid
  evidenceId      String   @map("evidence_id") @db.Uuid
  category        String?  // Which rating category this supports
  weight          Float    @default(1.0)
  relevanceScore  Float?   @map("relevance_score")
  linkedById      String   @map("linked_by_id") @db.Uuid
  linkedAt        DateTime @default(now()) @map("linked_at")
  notes           String?

  // Relations
  review          Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  evidence        Evidence @relation(fields: [evidenceId], references: [id], onDelete: Cascade)
  linkedBy        User     @relation("ReviewEvidenceLinker", fields: [linkedById], references: [id])

  @@unique([reviewId, evidenceId])
  @@index([reviewId])
  @@index([evidenceId])
  @@map("review_evidence")
}

// ============================================================================
// COMPENSATION DECISIONS (Persisted HR Decisions)
// ============================================================================

enum CompensationType {
  BASE_SALARY
  BONUS
  EQUITY
  COMMISSION
  ALLOWANCE
  BENEFITS
  ONE_TIME_PAYMENT
  RETENTION_BONUS
  SIGN_ON_BONUS
}

enum CompensationDecisionStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  REJECTED
  IMPLEMENTED
  CANCELLED
}

model CompensationDecision {
  id              String                     @id @default(uuid()) @db.Uuid
  tenantId        String                     @map("tenant_id") @db.Uuid
  employeeId      String                     @map("employee_id") @db.Uuid
  reviewCycleId   String?                    @map("review_cycle_id") @db.Uuid
  type            CompensationType
  status          CompensationDecisionStatus @default(DRAFT)

  // Amounts
  previousAmount  Float                      @map("previous_amount")
  newAmount       Float                      @map("new_amount")
  changeAmount    Float                      @map("change_amount")
  changePercent   Float                      @map("change_percent")
  currency        String                     @default("USD")

  // Decision context
  effectiveDate   DateTime                   @map("effective_date")
  reason          String
  justification   String?
  performanceRating Float?                   @map("performance_rating")
  marketData      Json?                      @map("market_data")
  equityAnalysis  Json?                      @map("equity_analysis")

  // Approval workflow
  proposedById    String                     @map("proposed_by_id") @db.Uuid
  proposedAt      DateTime                   @default(now()) @map("proposed_at")
  approvedById    String?                    @map("approved_by_id") @db.Uuid
  approvedAt      DateTime?                  @map("approved_at")
  rejectedById    String?                    @map("rejected_by_id") @db.Uuid
  rejectedAt      DateTime?                  @map("rejected_at")
  rejectionReason String?                    @map("rejection_reason")

  // Implementation
  implementedAt   DateTime?                  @map("implemented_at")
  implementedById String?                    @map("implemented_by_id") @db.Uuid
  payrollReference String?                   @map("payroll_reference")

  // Audit
  metadata        Json                       @default("{}")
  createdAt       DateTime                   @default(now()) @map("created_at")
  updatedAt       DateTime                   @updatedAt @map("updated_at")

  // Relations
  employee        User                       @relation("EmployeeCompensation", fields: [employeeId], references: [id])
  reviewCycle     ReviewCycle?               @relation(fields: [reviewCycleId], references: [id])
  proposedBy      User                       @relation("CompensationProposer", fields: [proposedById], references: [id])
  approvedBy      User?                      @relation("CompensationApprover", fields: [approvedById], references: [id])
  rejectedBy      User?                      @relation("CompensationRejecter", fields: [rejectedById], references: [id])
  implementedBy   User?                      @relation("CompensationImplementer", fields: [implementedById], references: [id])
  evidenceLinks   DecisionEvidence[]

  @@index([tenantId])
  @@index([employeeId])
  @@index([reviewCycleId])
  @@index([status])
  @@index([effectiveDate])
  @@index([type])
  @@map("compensation_decisions")
}

// ============================================================================
// PROMOTION DECISIONS (Persisted HR Decisions)
// ============================================================================

enum PromotionDecisionStatus {
  NOMINATED
  UNDER_REVIEW
  PENDING_APPROVAL
  APPROVED
  REJECTED
  DEFERRED
  IMPLEMENTED
  CANCELLED
}

enum PromotionType {
  LEVEL_PROMOTION
  ROLE_CHANGE
  TITLE_CHANGE
  LATERAL_MOVE
  CAREER_TRACK_CHANGE
}

model PromotionDecision {
  id                  String                  @id @default(uuid()) @db.Uuid
  tenantId            String                  @map("tenant_id") @db.Uuid
  employeeId          String                  @map("employee_id") @db.Uuid
  reviewCycleId       String?                 @map("review_cycle_id") @db.Uuid
  calibrationSessionId String?                @map("calibration_session_id") @db.Uuid
  type                PromotionType           @default(LEVEL_PROMOTION)
  status              PromotionDecisionStatus @default(NOMINATED)

  // Role/Level change
  previousRoleId      String?                 @map("previous_role_id") @db.Uuid
  newRoleId           String?                 @map("new_role_id") @db.Uuid
  previousLevel       Int?                    @map("previous_level")
  newLevel            Int?                    @map("new_level")
  previousTitle       String?                 @map("previous_title")
  newTitle            String?                 @map("new_title")

  // Decision context
  effectiveDate       DateTime?               @map("effective_date")
  readinessScore      Float?                  @map("readiness_score")
  criteriaScores      Json?                   @map("criteria_scores")
  strengths           String[]                @default([])
  developmentAreas    String[]                @default([]) @map("development_areas")
  justification       String?

  // Approval workflow
  nominatedById       String                  @map("nominated_by_id") @db.Uuid
  nominatedAt         DateTime                @default(now()) @map("nominated_at")
  reviewedById        String?                 @map("reviewed_by_id") @db.Uuid
  reviewedAt          DateTime?               @map("reviewed_at")
  approvedById        String?                 @map("approved_by_id") @db.Uuid
  approvedAt          DateTime?               @map("approved_at")
  rejectedById        String?                 @map("rejected_by_id") @db.Uuid
  rejectedAt          DateTime?               @map("rejected_at")
  rejectionReason     String?                 @map("rejection_reason")
  deferredUntil       DateTime?               @map("deferred_until")
  deferralReason      String?                 @map("deferral_reason")

  // Implementation
  implementedAt       DateTime?               @map("implemented_at")
  implementedById     String?                 @map("implemented_by_id") @db.Uuid
  hrisReference       String?                 @map("hris_reference")

  // Linked compensation change
  compensationDecisionId String?              @map("compensation_decision_id") @db.Uuid

  // Audit
  metadata            Json                    @default("{}")
  createdAt           DateTime                @default(now()) @map("created_at")
  updatedAt           DateTime                @updatedAt @map("updated_at")

  // Relations
  employee            User                    @relation("EmployeePromotion", fields: [employeeId], references: [id])
  reviewCycle         ReviewCycle?            @relation(fields: [reviewCycleId], references: [id])
  calibrationSession  CalibrationSession?     @relation(fields: [calibrationSessionId], references: [id])
  nominatedBy         User                    @relation("PromotionNominator", fields: [nominatedById], references: [id])
  reviewedBy          User?                   @relation("PromotionReviewer", fields: [reviewedById], references: [id])
  approvedBy          User?                   @relation("PromotionApprover", fields: [approvedById], references: [id])
  rejectedBy          User?                   @relation("PromotionRejecter", fields: [rejectedById], references: [id])
  implementedBy       User?                   @relation("PromotionImplementer", fields: [implementedById], references: [id])
  previousRole        Role?                   @relation("PreviousRole", fields: [previousRoleId], references: [id])
  newRole             Role?                   @relation("NewRole", fields: [newRoleId], references: [id])
  evidenceLinks       DecisionEvidence[]

  @@index([tenantId])
  @@index([employeeId])
  @@index([reviewCycleId])
  @@index([calibrationSessionId])
  @@index([status])
  @@index([effectiveDate])
  @@map("promotion_decisions")
}

// Link table: Evidence to Decisions (supports both compensation and promotion)
model DecisionEvidence {
  id                      String               @id @default(uuid()) @db.Uuid
  evidenceId              String               @map("evidence_id") @db.Uuid
  compensationDecisionId  String?              @map("compensation_decision_id") @db.Uuid
  promotionDecisionId     String?              @map("promotion_decision_id") @db.Uuid
  relevanceScore          Float?               @map("relevance_score")
  weight                  Float                @default(1.0)
  linkedById              String               @map("linked_by_id") @db.Uuid
  linkedAt                DateTime             @default(now()) @map("linked_at")
  notes                   String?

  // Relations
  evidence                Evidence             @relation(fields: [evidenceId], references: [id], onDelete: Cascade)
  compensationDecision    CompensationDecision? @relation(fields: [compensationDecisionId], references: [id], onDelete: Cascade)
  promotionDecision       PromotionDecision?   @relation(fields: [promotionDecisionId], references: [id], onDelete: Cascade)
  linkedBy                User                 @relation("DecisionEvidenceLinker", fields: [linkedById], references: [id])

  @@index([evidenceId])
  @@index([compensationDecisionId])
  @@index([promotionDecisionId])
  @@map("decision_evidence")
}

// ============================================================================
// AUDIT EVENTS (Immutable Log)
// ============================================================================

model AuditEvent {
  id            String   @id @default(uuid()) @db.Uuid
  tenantId      String   @map("tenant_id") @db.Uuid
  userId        String?  @map("user_id") @db.Uuid
  action        String
  entityType    String   @map("entity_type")
  entityId      String   @map("entity_id") @db.Uuid
  previousState Json?    @map("previous_state")
  newState      Json?    @map("new_state")
  metadata      Json     @default("{}")
  ipAddress     String?  @map("ip_address")
  userAgent     String?  @map("user_agent")
  createdAt     DateTime @default(now()) @map("created_at")

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user   User?  @relation("AuditUser", fields: [userId], references: [id])

  @@index([tenantId])
  @@index([userId])
  @@index([entityType, entityId])
  @@index([action])
  @@index([createdAt])
  @@map("audit_events")
}

// ============================================================================
// REAL-TIME PERFORMANCE TRACKING (Features 1-8)
// ============================================================================

// Hourly Performance Metrics (Feature 1: Hourly Performance Tracker)
model HourlyPerformanceMetric {
  id                String   @id @default(uuid()) @db.Uuid
  tenantId          String   @map("tenant_id") @db.Uuid
  userId            String   @map("user_id") @db.Uuid
  metricHour        DateTime @map("metric_hour")

  // Task metrics
  tasksCompleted       Int      @default(0) @map("tasks_completed")
  tasksCreated         Int      @default(0) @map("tasks_created")
  taskCompletionRate   Decimal  @default(0) @map("task_completion_rate") @db.Decimal(5, 2)

  // Time metrics
  activeMinutes        Int      @default(0) @map("active_minutes")
  focusMinutes         Int      @default(0) @map("focus_minutes")
  meetingMinutes       Int      @default(0) @map("meeting_minutes")

  // Goal metrics
  goalUpdates          Int      @default(0) @map("goal_updates")
  goalProgressDelta    Decimal  @default(0) @map("goal_progress_delta") @db.Decimal(5, 2)

  // Engagement metrics
  interactionsCount    Int      @default(0) @map("interactions_count")
  feedbackGiven        Int      @default(0) @map("feedback_given")
  feedbackReceived     Int      @default(0) @map("feedback_received")

  // Communication metrics
  messagesSent         Int      @default(0) @map("messages_sent")
  collaborationScore   Decimal? @map("collaboration_score") @db.Decimal(5, 2)

  // Quality metrics
  qualityScore         Decimal? @map("quality_score") @db.Decimal(5, 2)
  errorCount           Int      @default(0) @map("error_count")

  // Computed scores
  productivityScore    Decimal? @map("productivity_score") @db.Decimal(5, 2)
  engagementScore      Decimal? @map("engagement_score") @db.Decimal(5, 2)
  performanceScore     Decimal? @map("performance_score") @db.Decimal(5, 2)

  createdAt            DateTime @default(now()) @map("created_at")

  // Relations
  user                 User     @relation("UserHourlyMetrics", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tenantId, userId, metricHour])
  @@index([tenantId, userId])
  @@index([metricHour])
  @@index([tenantId, metricHour])
  @@map("hourly_performance_metrics")
}

// Daily Performance Metrics (Feature 2: 24/7 Activity Monitor)
model DailyPerformanceMetric {
  id                    String   @id @default(uuid()) @db.Uuid
  tenantId              String   @map("tenant_id") @db.Uuid
  userId                String   @map("user_id") @db.Uuid
  metricDate            DateTime @map("metric_date") @db.Date

  // Aggregated task metrics
  totalTasksCompleted   Int      @default(0) @map("total_tasks_completed")
  totalTasksCreated     Int      @default(0) @map("total_tasks_created")
  avgTaskCompletionRate Decimal  @default(0) @map("avg_task_completion_rate") @db.Decimal(5, 2)

  // Aggregated time metrics
  totalActiveMinutes    Int      @default(0) @map("total_active_minutes")
  totalFocusMinutes     Int      @default(0) @map("total_focus_minutes")
  totalMeetingMinutes   Int      @default(0) @map("total_meeting_minutes")
  firstActivityAt       DateTime? @map("first_activity_at")
  lastActivityAt        DateTime? @map("last_activity_at")

  // Aggregated goal metrics
  totalGoalUpdates      Int      @default(0) @map("total_goal_updates")
  totalGoalProgressDelta Decimal @default(0) @map("total_goal_progress_delta") @db.Decimal(5, 2)
  goalsOnTrack          Int      @default(0) @map("goals_on_track")
  goalsAtRisk           Int      @default(0) @map("goals_at_risk")
  goalsOffTrack         Int      @default(0) @map("goals_off_track")

  // Aggregated engagement metrics
  totalInteractions     Int      @default(0) @map("total_interactions")
  totalFeedbackGiven    Int      @default(0) @map("total_feedback_given")
  totalFeedbackReceived Int      @default(0) @map("total_feedback_received")

  // Aggregated communication metrics
  totalMessagesSent     Int      @default(0) @map("total_messages_sent")
  avgCollaborationScore Decimal? @map("avg_collaboration_score") @db.Decimal(5, 2)

  // Daily scores
  avgProductivityScore  Decimal? @map("avg_productivity_score") @db.Decimal(5, 2)
  avgEngagementScore    Decimal? @map("avg_engagement_score") @db.Decimal(5, 2)
  overallPerformanceScore Decimal? @map("overall_performance_score") @db.Decimal(5, 2)

  // Anomaly flags
  hasAnomaly            Boolean  @default(false) @map("has_anomaly")
  anomalyTypes          Json     @default("[]") @map("anomaly_types")

  // Trend indicators
  productivityTrend     String?  @map("productivity_trend")
  engagementTrend       String?  @map("engagement_trend")

  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  // Relations
  user                  User     @relation("UserDailyMetrics", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tenantId, userId, metricDate])
  @@index([tenantId, userId])
  @@index([metricDate])
  @@index([tenantId, metricDate])
  @@map("daily_performance_metrics")
}

// Activity Events (Feature 2: 24/7 Activity Monitor with AI Detection)
model ActivityEvent {
  id              String   @id @default(uuid()) @db.Uuid
  tenantId        String   @map("tenant_id") @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  eventType       String   @map("event_type")
  eventSubtype    String?  @map("event_subtype")
  entityType      String?  @map("entity_type")
  entityId        String?  @map("entity_id") @db.Uuid
  metadata        Json     @default("{}")
  durationSeconds Int?     @map("duration_seconds")
  isProductive    Boolean  @default(true) @map("is_productive")
  createdAt       DateTime @default(now()) @map("created_at")

  // Relations
  user            User     @relation("UserActivityEvents", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, userId])
  @@index([eventType])
  @@index([createdAt])
  @@index([tenantId, createdAt])
  @@map("activity_events")
}

// Performance Anomalies (Feature 6: Instant Performance Anomaly Detector)
model PerformanceAnomaly {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  userId                String    @map("user_id") @db.Uuid
  anomalyType           String    @map("anomaly_type")
  severity              String    // 'low', 'medium', 'high', 'critical'
  detectedAt            DateTime  @default(now()) @map("detected_at")

  // Anomaly details
  metricName            String    @map("metric_name")
  expectedValue         Decimal?  @map("expected_value") @db.Decimal(10, 2)
  actualValue           Decimal?  @map("actual_value") @db.Decimal(10, 2)
  deviationPercentage   Decimal?  @map("deviation_percentage") @db.Decimal(6, 2)
  zScore                Decimal?  @map("z_score") @db.Decimal(6, 2)

  // Context
  detectionWindowStart  DateTime? @map("detection_window_start")
  detectionWindowEnd    DateTime? @map("detection_window_end")
  baselinePeriodDays    Int?      @map("baseline_period_days")

  // Status
  status                String    @default("detected")
  acknowledgedById      String?   @map("acknowledged_by") @db.Uuid
  acknowledgedAt        DateTime? @map("acknowledged_at")
  resolvedAt            DateTime? @map("resolved_at")
  resolutionNotes       String?   @map("resolution_notes")

  // Notifications
  managerNotified       Boolean   @default(false) @map("manager_notified")
  managerNotifiedAt     DateTime? @map("manager_notified_at")

  metadata              Json      @default("{}")
  createdAt             DateTime  @default(now()) @map("created_at")

  // Relations
  user                  User      @relation("UserAnomalies", fields: [userId], references: [id], onDelete: Cascade)
  acknowledgedBy        User?     @relation("AnomalyAcknowledger", fields: [acknowledgedById], references: [id])

  @@index([tenantId, userId])
  @@index([anomalyType])
  @@index([severity])
  @@index([status])
  @@index([detectedAt])
  @@map("performance_anomalies")
}

// Deadline Alerts (Feature 4: Deadline Proximity Alert System)
model DeadlineAlert {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  userId                String    @map("user_id") @db.Uuid
  entityType            String    @map("entity_type")
  entityId              String    @map("entity_id") @db.Uuid
  entityTitle           String    @map("entity_title")

  // Deadline info
  deadline              DateTime
  daysUntilDeadline     Int?      @map("days_until_deadline")
  hoursUntilDeadline    Int?      @map("hours_until_deadline")

  // Progress & probability
  currentProgress       Decimal?  @map("current_progress") @db.Decimal(5, 2)
  requiredDailyProgress Decimal?  @map("required_daily_progress") @db.Decimal(5, 2)
  completionProbability Decimal?  @map("completion_probability") @db.Decimal(5, 2)

  // Alert status
  alertLevel            String    @map("alert_level")
  isAcknowledged        Boolean   @default(false) @map("is_acknowledged")
  acknowledgedAt        DateTime? @map("acknowledged_at")
  isSnoozed             Boolean   @default(false) @map("is_snoozed")
  snoozedUntil          DateTime? @map("snoozed_until")

  // Notifications
  lastNotifiedAt        DateTime? @map("last_notified_at")
  notificationCount     Int       @default(0) @map("notification_count")

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  user                  User      @relation("UserDeadlineAlerts", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, userId])
  @@index([deadline])
  @@index([alertLevel])
  @@index([entityType, entityId])
  @@map("deadline_alerts")
}

// Workload Snapshots (Feature 5: Live Workload Distribution Analyzer)
model WorkloadSnapshot {
  id                      String   @id @default(uuid()) @db.Uuid
  tenantId                String   @map("tenant_id") @db.Uuid
  userId                  String   @map("user_id") @db.Uuid
  snapshotTime            DateTime @default(now()) @map("snapshot_time")

  // Current workload
  activeGoals             Int      @default(0) @map("active_goals")
  activeTasks             Int      @default(0) @map("active_tasks")
  pendingReviews          Int      @default(0) @map("pending_reviews")
  scheduledMeetingsToday  Int      @default(0) @map("scheduled_meetings_today")

  // Capacity metrics
  estimatedHoursRequired  Decimal? @map("estimated_hours_required") @db.Decimal(6, 2)
  availableHours          Decimal? @map("available_hours") @db.Decimal(6, 2)
  capacityUtilization     Decimal? @map("capacity_utilization") @db.Decimal(5, 2)

  // Workload score
  workloadScore           Decimal? @map("workload_score") @db.Decimal(5, 2)
  balanceStatus           String?  @map("balance_status")

  // Recommendations
  redistributionRecommended Boolean @default(false) @map("redistribution_recommended")
  recommendedActions       Json    @default("[]") @map("recommended_actions")

  createdAt               DateTime @default(now()) @map("created_at")

  // Relations
  user                    User     @relation("UserWorkloadSnapshots", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, userId])
  @@index([snapshotTime])
  @@index([balanceStatus])
  @@map("workload_snapshots")
}

// Communication Sentiment (Feature 7: Real-Time Communication Sentiment Gauge)
model CommunicationSentiment {
  id                    String   @id @default(uuid()) @db.Uuid
  tenantId              String   @map("tenant_id") @db.Uuid
  userId                String   @map("user_id") @db.Uuid
  analysisPeriodStart   DateTime @map("analysis_period_start")
  analysisPeriodEnd     DateTime @map("analysis_period_end")

  // Sentiment scores
  overallSentimentScore Decimal? @map("overall_sentiment_score") @db.Decimal(5, 2)
  positivityRatio       Decimal? @map("positivity_ratio") @db.Decimal(5, 2)
  collaborationSentiment Decimal? @map("collaboration_sentiment") @db.Decimal(5, 2)
  stressIndicators      Decimal? @map("stress_indicators") @db.Decimal(5, 2)

  // Communication patterns
  communicationFrequency String?  @map("communication_frequency")
  responseTimeTrend      String?  @map("response_time_trend")
  engagementLevel        String?  @map("engagement_level")

  // Aggregated from sources
  feedbackSentiment      Decimal? @map("feedback_sentiment") @db.Decimal(5, 2)
  reviewTextSentiment    Decimal? @map("review_text_sentiment") @db.Decimal(5, 2)
  goalCommentSentiment   Decimal? @map("goal_comment_sentiment") @db.Decimal(5, 2)

  // Alerts
  moraleAlert            Boolean  @default(false) @map("morale_alert")
  moraleAlertReason      String?  @map("morale_alert_reason")

  createdAt              DateTime @default(now()) @map("created_at")

  // Relations
  user                   User     @relation("UserSentimentAnalysis", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, userId])
  @@index([analysisPeriodStart])
  @@map("communication_sentiment")
}

// Project Milestones (Feature 8: Live Project Milestone Tracker)
model ProjectMilestone {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  goalId              String?   @map("goal_id") @db.Uuid
  teamId              String?   @map("team_id") @db.Uuid

  title               String
  description         String?
  milestoneType       String?   @map("milestone_type")

  // Timeline
  plannedDate         DateTime  @map("planned_date")
  actualDate          DateTime? @map("actual_date")
  originalPlannedDate DateTime? @map("original_planned_date")

  // Progress
  status              String    @default("pending")
  progressPercentage  Decimal   @default(0) @map("progress_percentage") @db.Decimal(5, 2)
  completionCriteria  Json      @default("[]") @map("completion_criteria")

  // Dependencies
  dependsOn           String[]  @map("depends_on") @db.Uuid
  blockedBy           String[]  @map("blocked_by") @db.Uuid

  // Tracking
  autoDetected        Boolean   @default(false) @map("auto_detected")
  detectionConfidence Decimal?  @map("detection_confidence") @db.Decimal(5, 2)
  velocityBasedEta    DateTime? @map("velocity_based_eta")
  delayDays           Int       @default(0) @map("delay_days")

  // Assignments
  ownerId             String?   @map("owner_id") @db.Uuid
  contributors        String[]  @db.Uuid

  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  goal                Goal?     @relation("GoalMilestones", fields: [goalId], references: [id], onDelete: Cascade)
  team                Team?     @relation("TeamMilestones", fields: [teamId], references: [id], onDelete: Cascade)
  owner               User?     @relation("OwnedMilestones", fields: [ownerId], references: [id])
  progressEvents      MilestoneProgressEvent[]

  @@index([tenantId])
  @@index([goalId])
  @@index([teamId])
  @@index([status])
  @@index([plannedDate])
  @@map("project_milestones")
}

// Milestone Progress Events
model MilestoneProgressEvent {
  id            String    @id @default(uuid()) @db.Uuid
  milestoneId   String    @map("milestone_id") @db.Uuid
  eventType     String    @map("event_type")
  previousValue Json?     @map("previous_value")
  newValue      Json?     @map("new_value")
  triggeredById String?   @map("triggered_by") @db.Uuid
  triggerSource String?   @map("trigger_source")
  notes         String?
  createdAt     DateTime  @default(now()) @map("created_at")

  // Relations
  milestone     ProjectMilestone @relation(fields: [milestoneId], references: [id], onDelete: Cascade)
  triggeredBy   User?     @relation("MilestoneEventTriggerer", fields: [triggeredById], references: [id])

  @@index([milestoneId])
  @@index([eventType])
  @@index([createdAt])
  @@map("milestone_progress_events")
}

// Performance Alerts (Unified Alert System)
model PerformanceAlert {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  targetUserId        String?   @map("target_user_id") @db.Uuid
  targetTeamId        String?   @map("target_team_id") @db.Uuid
  targetDepartmentId  String?   @map("target_department_id") @db.Uuid

  alertType           String    @map("alert_type")
  alertCategory       String    @map("alert_category")
  severity            String
  priority            Int       @default(0)

  title               String
  description         String?
  actionRequired      String?   @map("action_required")
  actionUrl           String?   @map("action_url")

  // Status
  status              String    @default("active")
  acknowledgedById    String?   @map("acknowledged_by") @db.Uuid
  acknowledgedAt      DateTime? @map("acknowledged_at")
  resolvedAt          DateTime? @map("resolved_at")
  expiresAt           DateTime? @map("expires_at")

  // Notifications
  notifyUser          Boolean   @default(true) @map("notify_user")
  notifyManager       Boolean   @default(false) @map("notify_manager")
  notifyHr            Boolean   @default(false) @map("notify_hr")
  notificationChannels String[] @default(["in_app"]) @map("notification_channels")
  lastNotificationSent DateTime? @map("last_notification_sent")

  metadata            Json      @default("{}")
  createdAt           DateTime  @default(now()) @map("created_at")

  // Relations
  targetUser          User?     @relation("UserPerformanceAlerts", fields: [targetUserId], references: [id], onDelete: Cascade)
  targetTeam          Team?     @relation("TeamPerformanceAlerts", fields: [targetTeamId], references: [id], onDelete: Cascade)
  acknowledgedBy      User?     @relation("AlertAcknowledger", fields: [acknowledgedById], references: [id])

  @@index([tenantId])
  @@index([targetUserId])
  @@index([targetTeamId])
  @@index([alertCategory])
  @@index([status])
  @@index([severity])
  @@index([createdAt])
  @@map("performance_alerts")
}

// KPI Definitions (Feature 3: Real-Time Goal Progress Dashboard)
model KpiDefinition {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  name                String
  description         String?
  category            String
  unit                String?
  calculationFormula  String?  @map("calculation_formula")
  dataSources         Json     @default("[]") @map("data_sources")

  // Thresholds
  targetValue         Decimal? @map("target_value") @db.Decimal(10, 2)
  minValue            Decimal? @map("min_value") @db.Decimal(10, 2)
  maxValue            Decimal? @map("max_value") @db.Decimal(10, 2)
  greenThreshold      Decimal? @map("green_threshold") @db.Decimal(10, 2)
  yellowThreshold     Decimal? @map("yellow_threshold") @db.Decimal(10, 2)

  // Tracking settings
  trackingFrequency   String   @default("daily") @map("tracking_frequency")
  aggregationMethod   String   @default("avg") @map("aggregation_method")
  isHigherBetter      Boolean  @default(true) @map("is_higher_better")

  isActive            Boolean  @default(true) @map("is_active")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  // Relations
  values              KpiValue[]

  @@index([tenantId])
  @@index([category])
  @@map("kpi_definitions")
}

// KPI Values (Time-series)
model KpiValue {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  kpiDefinitionId     String   @map("kpi_definition_id") @db.Uuid
  userId              String?  @map("user_id") @db.Uuid
  teamId              String?  @map("team_id") @db.Uuid
  departmentId        String?  @map("department_id") @db.Uuid

  value               Decimal  @db.Decimal(10, 2)
  targetValue         Decimal? @map("target_value") @db.Decimal(10, 2)
  previousValue       Decimal? @map("previous_value") @db.Decimal(10, 2)
  changePercentage    Decimal? @map("change_percentage") @db.Decimal(6, 2)

  status              String?
  recordedAt          DateTime @default(now()) @map("recorded_at")
  periodStart         DateTime? @map("period_start")
  periodEnd           DateTime? @map("period_end")

  metadata            Json     @default("{}")

  // Relations
  kpiDefinition       KpiDefinition @relation(fields: [kpiDefinitionId], references: [id], onDelete: Cascade)
  user                User?    @relation("UserKpiValues", fields: [userId], references: [id], onDelete: Cascade)
  team                Team?    @relation("TeamKpiValues", fields: [teamId], references: [id], onDelete: Cascade)

  @@index([kpiDefinitionId])
  @@index([userId])
  @@index([teamId])
  @@index([recordedAt])
  @@index([tenantId, kpiDefinitionId, recordedAt])
  @@map("kpi_values")
}

// ============================================================================
// PERIODIC ANALYTICS & REPORTING ENGINE (Features 9-13)
// ============================================================================

// Report Definitions & Templates
model ReportDefinition {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  name                String
  description         String?
  reportType          String   @map("report_type") // WEEKLY_SUMMARY, MONTHLY_CARD, QUARTERLY_REVIEW, YEARLY_INDEX, COMPARATIVE_ANALYSIS

  // Template Configuration
  templateConfig      Json     @default("{}") @map("template_config")
  sections            Json     @default("[]") // Customizable report sections
  metrics             Json     @default("[]") // Metrics to include
  visualizations      Json     @default("[]") // Chart and graph configurations

  // Scheduling
  isScheduled         Boolean  @default(false) @map("is_scheduled")
  scheduleExpression  String?  @map("schedule_expression") // Cron expression
  scheduleTimezone    String   @default("UTC") @map("schedule_timezone")

  // Recipients & Notifications
  recipients          Json     @default("[]") // Email recipients
  notifyOnGeneration  Boolean  @default(true) @map("notify_on_generation")
  notificationChannels String[] @default(["email"]) @map("notification_channels")

  // Access Control
  visibility          String   @default("private") // private, team, department, all
  allowedRoles        String[] @default([]) @map("allowed_roles")

  // Export Settings
  exportFormats       String[] @default(["pdf"]) @map("export_formats") // pdf, excel, csv
  includeTrendAnalysis Boolean @default(true) @map("include_trend_analysis")
  includeVisualizations Boolean @default(true) @map("include_visualizations")
  includeRecommendations Boolean @default(true) @map("include_recommendations")

  isActive            Boolean  @default(true) @map("is_active")
  createdById         String   @map("created_by_id") @db.Uuid
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy           User     @relation("ReportDefinitionCreator", fields: [createdById], references: [id])
  generatedReports    GeneratedReport[]
  reportSchedules     ReportSchedule[]

  @@index([tenantId])
  @@index([reportType])
  @@index([isScheduled])
  @@index([createdById])
  @@map("report_definitions")
}

// Generated Reports
model GeneratedReport {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  reportDefinitionId  String?  @map("report_definition_id") @db.Uuid
  reportType          String   @map("report_type")

  // Report Period
  periodType          String   @map("period_type") // weekly, monthly, quarterly, yearly
  periodStart         DateTime @map("period_start")
  periodEnd           DateTime @map("period_end")
  periodLabel         String   @map("period_label") // e.g., "Q1 2025", "Week 5 2025"

  // Report Content
  title               String
  summary             String?
  data                Json     @default("{}") // Aggregated data
  trends              Json     @default("{}") // Trend analysis results
  comparisons         Json     @default("{}") // Period-over-period comparisons
  insights            Json     @default("[]") // AI-generated insights
  recommendations     Json     @default("[]") // AI-generated recommendations

  // Export Files
  pdfUrl              String?  @map("pdf_url")
  excelUrl            String?  @map("excel_url")
  csvUrl              String?  @map("csv_url")

  // Generation Metadata
  generationType      String   @default("scheduled") @map("generation_type") // scheduled, on_demand
  generatedById       String?  @map("generated_by_id") @db.Uuid
  generationStatus    String   @default("pending") @map("generation_status") // pending, processing, completed, failed
  generationStartedAt DateTime? @map("generation_started_at")
  generationCompletedAt DateTime? @map("generation_completed_at")
  generationError     String?  @map("generation_error")

  // Cache & Performance
  cacheKey            String?  @unique @map("cache_key")
  cacheDuration       Int      @default(3600) @map("cache_duration") // seconds

  // Access & Sharing
  accessCount         Int      @default(0) @map("access_count")
  lastAccessedAt      DateTime? @map("last_accessed_at")
  isPublic            Boolean  @default(false) @map("is_public")
  shareToken          String?  @unique @map("share_token")

  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  reportDefinition    ReportDefinition? @relation(fields: [reportDefinitionId], references: [id], onDelete: Cascade)
  generatedBy         User?    @relation("ReportGenerator", fields: [generatedById], references: [id])

  @@index([tenantId])
  @@index([reportDefinitionId])
  @@index([reportType])
  @@index([periodType])
  @@index([periodStart, periodEnd])
  @@index([generationStatus])
  @@index([createdAt])
  @@index([cacheKey])
  @@map("generated_reports")
}

// Aggregated Performance Data (Pre-computed for fast reporting)
model PerformanceAggregation {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid

  // Scope
  aggregationType     String   @map("aggregation_type") // user, team, department, business_unit, tenant
  entityId            String   @map("entity_id") @db.Uuid
  entityType          String   @map("entity_type") // user, team, department, business_unit, tenant

  // Time Period
  periodType          String   @map("period_type") // hourly, daily, weekly, monthly, quarterly, yearly
  periodStart         DateTime @map("period_start")
  periodEnd           DateTime @map("period_end")
  periodLabel         String   @map("period_label")

  // Goal Metrics
  totalGoals          Int      @default(0) @map("total_goals")
  completedGoals      Int      @default(0) @map("completed_goals")
  inProgressGoals     Int      @default(0) @map("in_progress_goals")
  notStartedGoals     Int      @default(0) @map("not_started_goals")
  onTrackGoals        Int      @default(0) @map("on_track_goals")
  atRiskGoals         Int      @default(0) @map("at_risk_goals")
  overdueGoals        Int      @default(0) @map("overdue_goals")
  avgGoalProgress     Decimal? @map("avg_goal_progress") @db.Decimal(5, 2)
  goalCompletionRate  Decimal? @map("goal_completion_rate") @db.Decimal(5, 2)

  // Review Metrics
  totalReviews        Int      @default(0) @map("total_reviews")
  completedReviews    Int      @default(0) @map("completed_reviews")
  pendingReviews      Int      @default(0) @map("pending_reviews")
  avgReviewRating     Decimal? @map("avg_review_rating") @db.Decimal(3, 2)
  reviewCompletionRate Decimal? @map("review_completion_rate") @db.Decimal(5, 2)

  // Feedback Metrics
  totalFeedback       Int      @default(0) @map("total_feedback")
  positiveFeedback    Int      @default(0) @map("positive_feedback")
  constructiveFeedback Int     @default(0) @map("constructive_feedback")
  avgSentimentScore   Decimal? @map("avg_sentiment_score") @db.Decimal(3, 2)

  // Performance Metrics
  avgProductivity     Decimal? @map("avg_productivity") @db.Decimal(5, 2)
  avgQuality          Decimal? @map("avg_quality") @db.Decimal(5, 2)
  avgCollaboration    Decimal? @map("avg_collaboration") @db.Decimal(5, 2)
  performanceScore    Decimal? @map("performance_score") @db.Decimal(5, 2)

  // Workload Metrics
  avgWorkloadHours    Decimal? @map("avg_workload_hours") @db.Decimal(5, 2)
  avgStressLevel      Decimal? @map("avg_stress_level") @db.Decimal(3, 2)
  avgWellbeingScore   Decimal? @map("avg_wellbeing_score") @db.Decimal(3, 2)

  // Activity Metrics
  totalActivities     Int      @default(0) @map("total_activities")
  activeUsers         Int      @default(0) @map("active_users")

  // Additional Metrics (flexible JSON)
  customMetrics       Json     @default("{}") @map("custom_metrics")

  // Metadata
  dataQuality         Decimal? @default(100) @map("data_quality") @db.Decimal(5, 2)
  dataCompleteness    Decimal? @default(100) @map("data_completeness") @db.Decimal(5, 2)

  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  @@unique([tenantId, aggregationType, entityId, periodType, periodStart])
  @@index([tenantId])
  @@index([aggregationType])
  @@index([entityId])
  @@index([periodType])
  @@index([periodStart, periodEnd])
  @@index([createdAt])
  @@map("performance_aggregations")
}

// Trend Analysis Results
model TrendAnalysis {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid

  // Scope
  entityType          String   @map("entity_type") // user, team, department, business_unit, tenant
  entityId            String   @map("entity_id") @db.Uuid

  // Metric Being Analyzed
  metricName          String   @map("metric_name")
  metricCategory      String   @map("metric_category")

  // Time Period
  periodType          String   @map("period_type") // weekly, monthly, quarterly, yearly
  periodStart         DateTime @map("period_start")
  periodEnd           DateTime @map("period_end")
  periodsAnalyzed     Int      @map("periods_analyzed") // Number of periods included

  // Trend Data
  trendDirection      String   @map("trend_direction") // increasing, decreasing, stable, volatile
  trendStrength       Decimal  @map("trend_strength") @db.Decimal(5, 2) // 0-100
  trendSlope          Decimal? @map("trend_slope") @db.Decimal(10, 4)

  // Statistical Analysis
  currentValue        Decimal  @map("current_value") @db.Decimal(10, 2)
  previousValue       Decimal? @map("previous_value") @db.Decimal(10, 2)
  changeAbsolute      Decimal? @map("change_absolute") @db.Decimal(10, 2)
  changePercentage    Decimal? @map("change_percentage") @db.Decimal(6, 2)

  // Moving Averages
  movingAvg7          Decimal? @map("moving_avg_7") @db.Decimal(10, 2)
  movingAvg30         Decimal? @map("moving_avg_30") @db.Decimal(10, 2)
  movingAvg90         Decimal? @map("moving_avg_90") @db.Decimal(10, 2)

  // Growth Rates
  weekOverWeekGrowth  Decimal? @map("week_over_week_growth") @db.Decimal(6, 2)
  monthOverMonthGrowth Decimal? @map("month_over_month_growth") @db.Decimal(6, 2)
  quarterOverQuarterGrowth Decimal? @map("quarter_over_quarter_growth") @db.Decimal(6, 2)
  yearOverYearGrowth  Decimal? @map("year_over_year_growth") @db.Decimal(6, 2)

  // Forecasting
  forecastedValue     Decimal? @map("forecasted_value") @db.Decimal(10, 2)
  forecastConfidence  Decimal? @map("forecast_confidence") @db.Decimal(5, 2)

  // Pattern Detection
  patternsDetected    Json     @default("[]") @map("patterns_detected") // seasonality, cycles, anomalies

  // Insights
  interpretation      String?  @map("interpretation")
  recommendations     Json     @default("[]")

  // Metadata
  calculationMethod   String   @default("linear_regression") @map("calculation_method")
  dataPoints          Int      @map("data_points")
  dataQuality         Decimal  @default(100) @map("data_quality") @db.Decimal(5, 2)

  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  @@unique([tenantId, entityType, entityId, metricName, periodType, periodStart])
  @@index([tenantId])
  @@index([entityType, entityId])
  @@index([metricName])
  @@index([periodType])
  @@index([periodStart, periodEnd])
  @@index([trendDirection])
  @@index([createdAt])
  @@map("trend_analyses")
}

// Report Schedules & Job Tracking
model ReportSchedule {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  reportDefinitionId  String   @map("report_definition_id") @db.Uuid

  // Schedule Configuration
  scheduleType        String   @map("schedule_type") // weekly, monthly, quarterly, yearly, custom
  cronExpression      String   @map("cron_expression")
  timezone            String   @default("UTC")

  // Execution Settings
  isActive            Boolean  @default(true) @map("is_active")
  startDate           DateTime @map("start_date")
  endDate             DateTime? @map("end_date")

  // Last Execution
  lastRunAt           DateTime? @map("last_run_at")
  lastRunStatus       String?  @map("last_run_status") // success, failed, skipped
  lastRunDuration     Int?     @map("last_run_duration") // milliseconds
  lastRunError        String?  @map("last_run_error")

  // Next Execution
  nextRunAt           DateTime? @map("next_run_at")

  // Execution Stats
  totalRuns           Int      @default(0) @map("total_runs")
  successfulRuns      Int      @default(0) @map("successful_runs")
  failedRuns          Int      @default(0) @map("failed_runs")
  avgExecutionTime    Int?     @map("avg_execution_time") // milliseconds

  // Retry Configuration
  retryOnFailure      Boolean  @default(true) @map("retry_on_failure")
  maxRetries          Int      @default(3) @map("max_retries")
  retryCount          Int      @default(0) @map("retry_count")

  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  reportDefinition    ReportDefinition @relation(fields: [reportDefinitionId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([reportDefinitionId])
  @@index([isActive])
  @@index([nextRunAt])
  @@index([lastRunAt])
  @@map("report_schedules")
}

// Background Job Queue
model BackgroundJob {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid

  // Job Details
  jobType             String   @map("job_type") // report_generation, data_aggregation, trend_analysis, email_notification
  jobName             String   @map("job_name")
  jobData             Json     @default("{}") @map("job_data")

  // Status
  status              String   @default("pending") @map("status") // pending, processing, completed, failed, cancelled
  priority            Int      @default(5) @map("priority") // 1-10, 10 being highest

  // Execution
  startedAt           DateTime? @map("started_at")
  completedAt         DateTime? @map("completed_at")
  executionTime       Int?     @map("execution_time") // milliseconds

  // Results
  result              Json?    @map("result")
  error               String?  @map("error")
  errorStack          String?  @map("error_stack")

  // Retry Logic
  attempts            Int      @default(0) @map("attempts")
  maxAttempts         Int      @default(3) @map("max_attempts")
  nextRetryAt         DateTime? @map("next_retry_at")

  // Progress Tracking
  progress            Int      @default(0) @map("progress") // 0-100
  progressMessage     String?  @map("progress_message")

  // Metadata
  createdById         String?  @map("created_by_id") @db.Uuid
  scheduledFor        DateTime? @map("scheduled_for")
  expiresAt           DateTime? @map("expires_at")

  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy           User?    @relation("BackgroundJobCreator", fields: [createdById], references: [id])

  @@index([tenantId])
  @@index([jobType])
  @@index([status])
  @@index([priority])
  @@index([scheduledFor])
  @@index([nextRetryAt])
  @@index([createdAt])
  @@map("background_jobs")
}

// ============================================================================
// ADVANCED VISUALIZATION & DASHBOARD INFRASTRUCTURE (Features 14-28)
// ============================================================================

// Dashboard Definitions
model Dashboard {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  name                String
  description         String?
  dashboardType       String   @map("dashboard_type") // EXECUTIVE, DEPARTMENT, PERSONAL, TEAM, CUSTOM

  // Layout Configuration
  layout              Json     @default("[]") @map("layout") // Grid layout configuration
  theme               Json     @default("{}") @map("theme") // Color scheme and styling

  // Access Control
  visibility          String   @default("private") // private, team, department, all
  ownerId             String   @map("owner_id") @db.Uuid
  sharedWith          String[] @default([]) @map("shared_with") // User IDs with access
  allowedRoles        String[] @default([]) @map("allowed_roles")

  // Settings
  refreshInterval     Int      @default(300) @map("refresh_interval") // seconds
  isDefault           Boolean  @default(false) @map("is_default")
  isTemplate          Boolean  @default(false) @map("is_template")

  // Metadata
  tags                String[] @default([])
  isActive            Boolean  @default(true) @map("is_active")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  owner               User     @relation("DashboardOwner", fields: [ownerId], references: [id])
  widgets             Widget[]

  @@index([tenantId])
  @@index([ownerId])
  @@index([dashboardType])
  @@index([isActive])
  @@map("dashboards")
}

// Widget Definitions
model Widget {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  dashboardId         String   @map("dashboard_id") @db.Uuid
  name                String
  description         String?

  // Widget Type and Configuration
  widgetType          String   @map("widget_type") // CHART, METRIC, TABLE, MAP, TIMELINE, etc.
  chartType           String?  @map("chart_type") // LINE, BAR, RADAR, GANTT, HEATMAP, etc.
  dataSource          Json     @default("{}") @map("data_source") // Query configuration
  configuration       Json     @default("{}") @map("configuration") // Widget-specific settings

  // Layout Properties
  position            Json     @default("{}") @map("position") // {x, y, w, h}
  zIndex              Int      @default(0) @map("z_index")

  // Display Settings
  title               String?
  showTitle           Boolean  @default(true) @map("show_title")
  showLegend          Boolean  @default(true) @map("show_legend")
  showTooltip         Boolean  @default(true) @map("show_tooltip")

  // Interactivity
  isDrilldownEnabled  Boolean  @default(false) @map("is_drilldown_enabled")
  drilldownConfig     Json?    @map("drilldown_config")
  clickActions        Json?    @map("click_actions")

  // Data Refresh
  refreshInterval     Int?     @map("refresh_interval") // seconds, null = use dashboard default
  lastRefreshedAt     DateTime? @map("last_refreshed_at")

  // Cache
  cachedData          Json?    @map("cached_data")
  cacheExpiresAt      DateTime? @map("cache_expires_at")

  // Metadata
  isActive            Boolean  @default(true) @map("is_active")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  dashboard           Dashboard @relation(fields: [dashboardId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([dashboardId])
  @@index([widgetType])
  @@index([isActive])
  @@map("widgets")
}

// Leaderboard Configurations
model Leaderboard {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  name                String
  description         String?

  // Leaderboard Type
  leaderboardType     String   @map("leaderboard_type") // PERFORMANCE, GOALS, REVIEWS, CUSTOM
  scope               String   @map("scope") // team, department, business_unit, tenant

  // Ranking Configuration
  metricName          String   @map("metric_name")
  metricCategory      String   @map("metric_category")
  sortOrder           String   @default("desc") @map("sort_order") // asc, desc
  rankingPeriod       String   @map("ranking_period") // daily, weekly, monthly, quarterly, yearly, all_time

  // Gamification
  badges              Json     @default("[]") @map("badges") // Badge definitions
  levels              Json     @default("[]") @map("levels") // Level thresholds
  rewards             Json     @default("[]") @map("rewards") // Reward configurations

  // Display Settings
  topN                Int      @default(10) @map("top_n") // Show top N entries
  showRank            Boolean  @default(true) @map("show_rank")
  showAvatar          Boolean  @default(true) @map("show_avatar")
  showScore           Boolean  @default(true) @map("show_score")
  showTrend           Boolean  @default(true) @map("show_trend")
  showBadges          Boolean  @default(true) @map("show_badges")

  // Refresh
  refreshInterval     Int      @default(300) @map("refresh_interval") // seconds

  isActive            Boolean  @default(true) @map("is_active")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  entries             LeaderboardEntry[]

  @@index([tenantId])
  @@index([leaderboardType])
  @@index([scope])
  @@map("leaderboards")
}

// Leaderboard Entries (Cached Rankings)
model LeaderboardEntry {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  leaderboardId       String   @map("leaderboard_id") @db.Uuid
  userId              String   @map("user_id") @db.Uuid

  // Ranking
  rank                Int
  previousRank        Int?     @map("previous_rank")
  score               Decimal  @db.Decimal(10, 2)
  previousScore       Decimal? @map("previous_score") @db.Decimal(10, 2)

  // Trends
  rankChange          Int?     @map("rank_change") // Change from previous period
  scoreChange         Decimal? @map("score_change") @db.Decimal(10, 2)
  trend               String?  @map("trend") // up, down, stable

  // Gamification
  earnedBadges        String[] @default([]) @map("earned_badges")
  currentLevel        String?  @map("current_level")
  pointsToNextLevel   Int?     @map("points_to_next_level")

  // Period
  periodStart         DateTime @map("period_start")
  periodEnd           DateTime @map("period_end")
  periodLabel         String   @map("period_label")

  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  leaderboard         Leaderboard @relation(fields: [leaderboardId], references: [id], onDelete: Cascade)
  user                User     @relation("UserLeaderboardEntries", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([leaderboardId, userId, periodStart])
  @@index([tenantId])
  @@index([leaderboardId])
  @@index([userId])
  @@index([rank])
  @@index([periodStart])
  @@map("leaderboard_entries")
}

// Geographic Performance Data
model GeographicPerformance {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid

  // Location
  countryCode         String   @map("country_code") // ISO 3166-1 alpha-2
  countryName         String   @map("country_name")
  regionCode          String?  @map("region_code") // State/Province code
  regionName          String?  @map("region_name")
  cityName            String?  @map("city_name")

  // Coordinates
  latitude            Decimal? @db.Decimal(9, 6)
  longitude           Decimal? @db.Decimal(9, 6)

  // Performance Metrics
  employeeCount       Int      @default(0) @map("employee_count")
  avgPerformanceScore Decimal? @map("avg_performance_score") @db.Decimal(5, 2)
  avgGoalCompletion   Decimal? @map("avg_goal_completion") @db.Decimal(5, 2)
  avgWellbeingScore   Decimal? @map("avg_wellbeing_score") @db.Decimal(3, 2)
  totalFeedback       Int      @default(0) @map("total_feedback")

  // Period
  periodType          String   @map("period_type") // monthly, quarterly, yearly
  periodStart         DateTime @map("period_start")
  periodEnd           DateTime @map("period_end")
  periodLabel         String   @map("period_label")

  // Additional Metrics
  customMetrics       Json     @default("{}") @map("custom_metrics")

  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, countryCode, regionCode, cityName, periodType, periodStart])
  @@index([tenantId])
  @@index([countryCode])
  @@index([periodType])
  @@index([periodStart])
  @@map("geographic_performance")
}

// Notification Board Items (Real-Time Alerts)
model NotificationBoardItem {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid

  // Item Type
  itemType            String   @map("item_type") // ALERT, MILESTONE, ACHIEVEMENT, DEADLINE, ANNOUNCEMENT
  category            String   @map("category")
  priority            String   @default("normal") @map("priority") // low, normal, high, urgent

  // Content
  title               String
  message             String
  details             Json?    @map("details")

  // Target
  targetType          String?  @map("target_type") // user, team, department, tenant
  targetId            String?  @map("target_id") @db.Uuid
  affectedUserIds     String[] @default([]) @map("affected_user_ids")

  // Actions
  actionUrl           String?  @map("action_url")
  actionLabel         String?  @map("action_label")
  isDismissible       Boolean  @default(true) @map("is_dismissible")

  // Status
  status              String   @default("active") @map("status") // active, dismissed, expired
  expiresAt           DateTime? @map("expires_at")
  isRead              Boolean  @default(false) @map("is_read")

  // Source
  sourceType          String   @map("source_type") // system, goal, review, feedback, kpi
  sourceId            String?  @map("source_id") @db.Uuid

  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([itemType])
  @@index([status])
  @@index([priority])
  @@index([targetType, targetId])
  @@index([createdAt])
  @@map("notification_board_items")
}

// ============================================================================
// 360 FEEDBACK & MULTI-PERSPECTIVE APPRAISAL SYSTEM (Features 29-34)
// ============================================================================

// Feedback Cycle Management
model FeedbackCycle {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  name                String
  description         String?
  cycleType           String   @map("cycle_type")
  isMandatory         Boolean  @default(false) @map("is_mandatory")
  includeManager      Boolean  @default(true) @map("include_manager")
  includePeers        Boolean  @default(true) @map("include_peers")
  includeDirectReports Boolean @default(true) @map("include_direct_reports")
  includeSelfEval     Boolean  @default(true) @map("include_self_eval")
  includeCrossFunctional Boolean @default(true) @map("include_cross_functional")
  includeStakeholders Boolean  @default(false) @map("include_stakeholders")
  minPeerReviewers    Int      @default(3) @map("min_peer_reviewers")
  maxPeerReviewers    Int      @default(5) @map("max_peer_reviewers")
  allowSelfNomination Boolean  @default(true) @map("allow_self_nomination")
  nominationStartDate DateTime @map("nomination_start_date")
  nominationEndDate   DateTime @map("nomination_end_date")
  feedbackStartDate   DateTime @map("feedback_start_date")
  feedbackEndDate     DateTime @map("feedback_end_date")
  resultsReleaseDate  DateTime? @map("results_release_date")
  status              String   @default("DRAFT") @map("status")
  isAnonymous         Boolean  @default(true) @map("is_anonymous")
  minResponsesForAnonymity Int @default(3) @map("min_responses_for_anonymity")
  showIndividualResponses Boolean @default(false) @map("show_individual_responses")
  questionnaireId     String?  @map("questionnaire_id") @db.Uuid
  sendReminders       Boolean  @default(true) @map("send_reminders")
  reminderFrequency   Int      @default(3) @map("reminder_frequency")
  participantIds      String[] @default([]) @map("participant_ids")
  visibleToParticipants Boolean @default(false) @map("visible_to_participants")
  createdById         String   @map("created_by_id") @db.Uuid
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy           User     @relation("FeedbackCycleCreator", fields: [createdById], references: [id])
  questionnaire       FeedbackQuestionnaire? @relation(fields: [questionnaireId], references: [id])
  nominations         FeedbackNomination[]
  requests            FeedbackRequest[]
  responses           FeedbackResponse[]

  @@index([tenantId])
  @@index([status])
  @@index([cycleType])
  @@index([feedbackStartDate, feedbackEndDate])
  @@map("feedback_cycles")
}

model FeedbackQuestionnaire {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  name                String
  description         String?
  questionnaireType   String   @map("questionnaire_type")
  isTemplate          Boolean  @default(false) @map("is_template")
  isActive            Boolean  @default(true) @map("is_active")
  useAIAdaptation     Boolean  @default(false) @map("use_ai_adaptation")
  adaptationCriteria  Json?    @map("adaptation_criteria")
  questions           Json     @default("[]") @map("questions")
  competencyIds       String[] @default([]) @map("competency_ids")
  createdById         String   @map("created_by_id") @db.Uuid
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy           User     @relation("QuestionnaireCreator", fields: [createdById], references: [id])
  cycles              FeedbackCycle[]

  @@index([tenantId])
  @@index([questionnaireType])
  @@index([isTemplate])
  @@map("feedback_questionnaires")
}

model FeedbackNomination {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  cycleId             String   @map("cycle_id") @db.Uuid
  subjectId           String   @map("subject_id") @db.Uuid
  reviewerId          String   @map("reviewer_id") @db.Uuid
  relationship        String   @map("relationship")
  nominatedBy         String   @map("nominated_by") @db.Uuid
  nominationReason    String?  @map("nomination_reason")
  status              String   @default("PENDING") @map("status")
  approvedBy          String?  @map("approved_by") @db.Uuid
  approvedAt          DateTime? @map("approved_at")
  rejectionReason     String?  @map("rejection_reason")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  cycle               FeedbackCycle @relation(fields: [cycleId], references: [id], onDelete: Cascade)
  subject             User     @relation("FeedbackSubject", fields: [subjectId], references: [id], onDelete: Cascade)
  reviewer            User     @relation("FeedbackReviewer", fields: [reviewerId], references: [id], onDelete: Cascade)
  nominator           User     @relation("FeedbackNominator", fields: [nominatedBy], references: [id])
  approver            User?    @relation("NominationApprover", fields: [approvedBy], references: [id])

  @@unique([cycleId, subjectId, reviewerId, relationship])
  @@index([tenantId])
  @@index([cycleId])
  @@index([subjectId])
  @@index([reviewerId])
  @@index([status])
  @@index([relationship])
  @@map("feedback_nominations")
}

model FeedbackRequest {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  cycleId             String   @map("cycle_id") @db.Uuid
  nominationId        String?  @map("nomination_id") @db.Uuid
  subjectId           String   @map("subject_id") @db.Uuid
  reviewerId          String   @map("reviewer_id") @db.Uuid
  relationship        String   @map("relationship")
  status              String   @default("PENDING") @map("status")
  sentAt              DateTime @default(now()) @map("sent_at")
  dueDate             DateTime @map("due_date")
  completedAt         DateTime? @map("completed_at")
  declinedAt          DateTime? @map("declined_at")
  declineReason       String?  @map("decline_reason")
  remindersSent       Int      @default(0) @map("reminders_sent")
  lastReminderAt      DateTime? @map("last_reminder_at")
  accessToken         String?  @unique @map("access_token")
  expiresAt           DateTime? @map("expires_at")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  cycle               FeedbackCycle @relation(fields: [cycleId], references: [id], onDelete: Cascade)
  subject             User     @relation("RequestSubject", fields: [subjectId], references: [id], onDelete: Cascade)
  reviewer            User     @relation("RequestReviewer", fields: [reviewerId], references: [id], onDelete: Cascade)
  responses           FeedbackResponse[]

  @@index([tenantId])
  @@index([cycleId])
  @@index([subjectId])
  @@index([reviewerId])
  @@index([status])
  @@index([dueDate])
  @@map("feedback_requests")
}

model FeedbackResponse {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  cycleId             String   @map("cycle_id") @db.Uuid
  requestId           String   @map("request_id") @db.Uuid
  subjectId           String   @map("subject_id") @db.Uuid
  reviewerId          String   @map("reviewer_id") @db.Uuid
  relationship        String   @map("relationship")
  isAnonymous         Boolean  @default(true) @map("is_anonymous")
  anonymousId         String   @map("anonymous_id")
  responses           Json     @default("{}") @map("responses")
  ratings             Json     @default("{}") @map("ratings")
  overallRating       Decimal? @map("overall_rating") @db.Decimal(3, 2)
  strengths           String?  @map("strengths")
  areasForImprovement String?  @map("areas_for_improvement")
  additionalComments  String?  @map("additional_comments")
  sentimentScore      Decimal? @map("sentiment_score") @db.Decimal(3, 2)
  sentimentLabel      String?  @map("sentiment_label")
  keyPhrases          String[] @default([]) @map("key_phrases")
  status              String   @default("DRAFT") @map("status")
  submittedAt         DateTime? @map("submitted_at")
  timeSpentMinutes    Int?     @map("time_spent_minutes")
  version             Int      @default(1) @map("version")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  cycle               FeedbackCycle @relation(fields: [cycleId], references: [id], onDelete: Cascade)
  request             FeedbackRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  subject             User     @relation("ResponseSubject", fields: [subjectId], references: [id], onDelete: Cascade)
  reviewer            User     @relation("ResponseReviewer", fields: [reviewerId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([cycleId])
  @@index([subjectId])
  @@index([reviewerId])
  @@index([status])
  @@index([relationship])
  @@index([anonymousId])
  @@map("feedback_responses")
}

model FeedbackAggregation {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  cycleId             String   @map("cycle_id") @db.Uuid
  subjectId           String   @map("subject_id") @db.Uuid
  aggregationType     String   @map("aggregation_type")
  responseCount       Int      @default(0) @map("response_count")
  avgOverallRating    Decimal? @map("avg_overall_rating") @db.Decimal(3, 2)
  avgRatings          Json     @default("{}") @map("avg_ratings")
  ratingDistribution  Json     @default("{}") @map("rating_distribution")
  commonStrengths     String[] @default([]) @map("common_strengths")
  commonImprovements  String[] @default([]) @map("common_improvements")
  keyThemes           Json     @default("[]") @map("key_themes")
  avgSentiment        Decimal? @map("avg_sentiment") @db.Decimal(3, 2)
  sentimentDistribution Json   @default("{}") @map("sentiment_distribution")
  standardDeviation   Decimal? @map("standard_deviation") @db.Decimal(3, 2)
  confidenceScore     Decimal? @map("confidence_score") @db.Decimal(3, 2)
  meetsAnonymityThreshold Boolean @default(false) @map("meets_anonymity_threshold")
  lastProcessedAt     DateTime? @map("last_processed_at")
  processingVersion   Int      @default(1) @map("processing_version")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  subject             User     @relation("AggregationSubject", fields: [subjectId], references: [id], onDelete: Cascade)

  @@unique([cycleId, subjectId, aggregationType])
  @@index([tenantId])
  @@index([cycleId])
  @@index([subjectId])
  @@index([aggregationType])
  @@map("feedback_aggregations")
}

model FeedbackGapAnalysis {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  cycleId             String   @map("cycle_id") @db.Uuid
  subjectId           String   @map("subject_id") @db.Uuid
  dimension           String   @map("dimension")
  selfRating          Decimal? @map("self_rating") @db.Decimal(3, 2)
  managerRating       Decimal? @map("manager_rating") @db.Decimal(3, 2)
  peerAvgRating       Decimal? @map("peer_avg_rating") @db.Decimal(3, 2)
  directReportAvgRating Decimal? @map("direct_report_avg_rating") @db.Decimal(3, 2)
  stakeholderAvgRating Decimal? @map("stakeholder_avg_rating") @db.Decimal(3, 2)
  selfManagerGap      Decimal? @map("self_manager_gap") @db.Decimal(3, 2)
  selfPeerGap         Decimal? @map("self_peer_gap") @db.Decimal(3, 2)
  managerPeerGap      Decimal? @map("manager_peer_gap") @db.Decimal(3, 2)
  gapSeverity         String?  @map("gap_severity")
  gapType             String?  @map("gap_type")
  interpretation      String?  @map("interpretation")
  recommendations     Json     @default("[]") @map("recommendations")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  subject             User     @relation("GapAnalysisSubject", fields: [subjectId], references: [id], onDelete: Cascade)

  @@unique([cycleId, subjectId, dimension])
  @@index([tenantId])
  @@index([cycleId])
  @@index([subjectId])
  @@index([gapSeverity])
  @@map("feedback_gap_analyses")
}

model FeedbackAccessControl {
  id                  String   @id @default(uuid()) @db.Uuid
  tenantId            String   @map("tenant_id") @db.Uuid
  cycleId             String   @map("cycle_id") @db.Uuid
  userId              String   @map("user_id") @db.Uuid
  canViewOwnResults   Boolean  @default(false) @map("can_view_own_results")
  canViewAggregated   Boolean  @default(false) @map("can_view_aggregated")
  canViewIndividual   Boolean  @default(false) @map("can_view_individual")
  canViewComparisons  Boolean  @default(false) @map("can_view_comparisons")
  canExportResults    Boolean  @default(false) @map("can_export_results")
  grantedBy           String   @map("granted_by") @db.Uuid
  grantedAt           DateTime @default(now()) @map("granted_at")
  expiresAt           DateTime? @map("expires_at")

  tenant              Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User     @relation("FeedbackAccessUser", fields: [userId], references: [id], onDelete: Cascade)
  grantor             User     @relation("AccessGrantor", fields: [grantedBy], references: [id])

  @@unique([cycleId, userId])
  @@index([tenantId])
  @@index([cycleId])
  @@index([userId])
  @@map("feedback_access_controls")
}

// ============================================================================
// EVALUATION & ASSESSMENT MODULES (Features 35-40)
// ============================================================================

// Feature 35: Technological Performance Audit Tool
model TechnicalSkillAssessment {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid
  assessmentCycleId   String?   @map("assessment_cycle_id") @db.Uuid

  skillCategoryId     String    @map("skill_category_id") @db.Uuid
  skillName           String    @map("skill_name")
  skillLevel          String    @map("skill_level") // BEGINNER, INTERMEDIATE, ADVANCED, EXPERT

  // Assessment Methods
  selfAssessment      Decimal?  @map("self_assessment") @db.Decimal(3, 2)
  managerAssessment   Decimal?  @map("manager_assessment") @db.Decimal(3, 2)
  testScore           Decimal?  @map("test_score") @db.Decimal(5, 2)
  peerReviewScore     Decimal?  @map("peer_review_score") @db.Decimal(3, 2)
  projectBasedScore   Decimal?  @map("project_based_score") @db.Decimal(3, 2)

  // Behavioral Evidence
  codeQualityScore    Decimal?  @map("code_quality_score") @db.Decimal(3, 2)
  productivityScore   Decimal?  @map("productivity_score") @db.Decimal(3, 2)
  collaborationScore  Decimal?  @map("collaboration_score") @db.Decimal(3, 2)

  // Aggregated Score
  finalScore          Decimal   @map("final_score") @db.Decimal(3, 2)
  scoreWeights        Json      @default("{}") @map("score_weights")
  confidence          Decimal?  @map("confidence") @db.Decimal(3, 2)

  // Evidence Collection
  evidenceLinks       Json      @default("[]") @map("evidence_links")
  behavioralEvents    Json      @default("[]") @map("behavioral_events")
  testResults         Json?     @map("test_results")

  // Tracking
  lastAssessedAt      DateTime  @map("last_assessed_at")
  nextAssessmentDue   DateTime? @map("next_assessment_due")
  improvementPlan     String?   @map("improvement_plan")
  certifications      Json      @default("[]") @map("certifications")

  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User      @relation("UserTechnicalSkills", fields: [userId], references: [id], onDelete: Cascade)
  skillCategory       SkillCategory @relation(fields: [skillCategoryId], references: [id])
  assessmentCycle     AssessmentCycle? @relation("CycleTechnicalAssessments", fields: [assessmentCycleId], references: [id])
  progressHistory     SkillProgressHistory[]

  @@index([tenantId])
  @@index([userId])
  @@index([skillCategoryId])
  @@index([assessmentCycleId])
  @@index([skillLevel])
  @@index([lastAssessedAt])
  @@map("technical_skill_assessments")
}

model SkillCategory {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  name                String
  description         String?
  categoryType        String    @map("category_type") // TECHNICAL, BEHAVIORAL, LEADERSHIP
  parentId            String?   @map("parent_id") @db.Uuid

  // Framework
  competencyFramework Json      @default("{}") @map("competency_framework")
  levelDefinitions    Json      @default("[]") @map("level_definitions")
  assessmentCriteria  Json      @default("[]") @map("assessment_criteria")

  // Weighting
  defaultWeight       Decimal   @default(1.0) @map("default_weight") @db.Decimal(3, 2)
  industryStandard    String?   @map("industry_standard")

  isActive            Boolean   @default(true) @map("is_active")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  parent              SkillCategory? @relation("SkillCategoryHierarchy", fields: [parentId], references: [id])
  children            SkillCategory[] @relation("SkillCategoryHierarchy")
  technicalAssessments TechnicalSkillAssessment[]
  behavioralAssessments BehavioralCompetencyScore[]
  leadershipAssessments LeadershipCompetencyScore[]

  @@unique([tenantId, name])
  @@index([tenantId])
  @@index([categoryType])
  @@index([parentId])
  @@map("skill_categories")
}

model SkillProgressHistory {
  id                  String    @id @default(uuid()) @db.Uuid
  assessmentId        String    @map("assessment_id") @db.Uuid
  previousScore       Decimal   @map("previous_score") @db.Decimal(3, 2)
  newScore            Decimal   @map("new_score") @db.Decimal(3, 2)
  changeReason        String?   @map("change_reason")
  evidenceId          String?   @map("evidence_id") @db.Uuid
  assessedBy          String?   @map("assessed_by") @db.Uuid
  notes               String?
  createdAt           DateTime  @default(now()) @map("created_at")

  // Relations
  assessment          TechnicalSkillAssessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  assessor            User?     @relation("SkillAssessor", fields: [assessedBy], references: [id])

  @@index([assessmentId])
  @@index([createdAt])
  @@map("skill_progress_history")
}

// Feature 36: Project Evaluation Framework
model ProjectEvaluation {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  projectId           String?   @map("project_id") @db.Uuid
  goalId              String?   @map("goal_id") @db.Uuid
  evaluationCycleId   String?   @map("evaluation_cycle_id") @db.Uuid

  projectName         String    @map("project_name")
  projectType         String?   @map("project_type")
  evaluationStatus    String    @default("IN_PROGRESS") @map("evaluation_status")

  // Timeline Metrics
  plannedStartDate    DateTime  @map("planned_start_date")
  actualStartDate     DateTime? @map("actual_start_date")
  plannedEndDate      DateTime  @map("planned_end_date")
  actualEndDate       DateTime? @map("actual_end_date")
  timelineScore       Decimal?  @map("timeline_score") @db.Decimal(3, 2)
  delayDays           Int       @default(0) @map("delay_days")

  // Budget Metrics
  plannedBudget       Decimal?  @map("planned_budget") @db.Decimal(15, 2)
  actualBudget        Decimal?  @map("actual_budget") @db.Decimal(15, 2)
  budgetVariance      Decimal?  @map("budget_variance") @db.Decimal(15, 2)
  budgetScore         Decimal?  @map("budget_score") @db.Decimal(3, 2)

  // Quality Metrics
  qualityScore        Decimal?  @map("quality_score") @db.Decimal(3, 2)
  defectCount         Int       @default(0) @map("defect_count")
  criticalIssues      Int       @default(0) @map("critical_issues")
  requirementsMet     Decimal?  @map("requirements_met") @db.Decimal(5, 2)
  technicalDebt       String?   @map("technical_debt")

  // Satisfaction Metrics
  stakeholderSatisfaction Decimal? @map("stakeholder_satisfaction") @db.Decimal(3, 2)
  teamSatisfaction    Decimal?  @map("team_satisfaction") @db.Decimal(3, 2)
  clientFeedback      Json?     @map("client_feedback")
  npsScore            Int?      @map("nps_score")

  // Contribution Assessment
  teamMembers         Json      @default("[]") @map("team_members")
  individualContributions Json  @default("[]") @map("individual_contributions")

  // Overall Score
  overallScore        Decimal?  @map("overall_score") @db.Decimal(3, 2)
  scoreWeights        Json      @default("{}") @map("score_weights")

  // Lessons & Insights
  successFactors      Json      @default("[]") @map("success_factors")
  improvementAreas    Json      @default("[]") @map("improvement_areas")
  lessonsLearned      String?   @map("lessons_learned")
  recommendations     Json      @default("[]") @map("recommendations")

  evaluatedBy         String?   @map("evaluated_by") @db.Uuid
  evaluatedAt         DateTime? @map("evaluated_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  goal                Goal?     @relation("GoalProjectEvaluations", fields: [goalId], references: [id])
  evaluator           User?     @relation("ProjectEvaluator", fields: [evaluatedBy], references: [id])
  assessmentCycle     AssessmentCycle? @relation("CycleProjectEvaluations", fields: [evaluationCycleId], references: [id])
  contributionScores  ProjectContributionScore[]

  @@index([tenantId])
  @@index([projectId])
  @@index([goalId])
  @@index([evaluationCycleId])
  @@index([evaluationStatus])
  @@index([evaluatedAt])
  @@map("project_evaluations")
}

model ProjectContributionScore {
  id                  String    @id @default(uuid()) @db.Uuid
  projectEvaluationId String    @map("project_evaluation_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid

  role                String
  contributionType    String    @map("contribution_type")

  // Contribution Scores
  qualityScore        Decimal   @map("quality_score") @db.Decimal(3, 2)
  velocityScore       Decimal   @map("velocity_score") @db.Decimal(3, 2)
  innovationScore     Decimal   @map("innovation_score") @db.Decimal(3, 2)
  collaborationScore  Decimal   @map("collaboration_score") @db.Decimal(3, 2)
  leadershipScore     Decimal?  @map("leadership_score") @db.Decimal(3, 2)

  overallScore        Decimal   @map("overall_score") @db.Decimal(3, 2)

  // Evidence
  keyAccomplishments  Json      @default("[]") @map("key_accomplishments")
  evidenceLinks       Json      @default("[]") @map("evidence_links")
  peerFeedback        Json      @default("[]") @map("peer_feedback")

  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  projectEvaluation   ProjectEvaluation @relation(fields: [projectEvaluationId], references: [id], onDelete: Cascade)
  user                User      @relation("UserProjectContributions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectEvaluationId, userId])
  @@index([projectEvaluationId])
  @@index([userId])
  @@map("project_contribution_scores")
}

// Feature 37: Leadership Competency Evaluator
model LeadershipCompetencyScore {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid
  assessmentCycleId   String?   @map("assessment_cycle_id") @db.Uuid
  competencyCategoryId String   @map("competency_category_id") @db.Uuid

  // Core Leadership Dimensions
  visionSettingScore  Decimal?  @map("vision_setting_score") @db.Decimal(3, 2)
  decisionMakingScore Decimal?  @map("decision_making_score") @db.Decimal(3, 2)
  teamDevelopmentScore Decimal? @map("team_development_score") @db.Decimal(3, 2)
  adaptabilityScore   Decimal?  @map("adaptability_score") @db.Decimal(3, 2)
  strategicThinkingScore Decimal? @map("strategic_thinking_score") @db.Decimal(3, 2)
  executionScore      Decimal?  @map("execution_score") @db.Decimal(3, 2)

  // Additional Dimensions
  empowermentScore    Decimal?  @map("empowerment_score") @db.Decimal(3, 2)
  conflictResolutionScore Decimal? @map("conflict_resolution_score") @db.Decimal(3, 2)
  changeManagementScore Decimal? @map("change_management_score") @db.Decimal(3, 2)

  // Overall Score
  overallScore        Decimal   @map("overall_score") @db.Decimal(3, 2)
  scoreWeights        Json      @default("{}") @map("score_weights")

  // 360 Sources
  selfAssessment      Decimal?  @map("self_assessment") @db.Decimal(3, 2)
  managerAssessment   Decimal?  @map("manager_assessment") @db.Decimal(3, 2)
  peerAvgScore        Decimal?  @map("peer_avg_score") @db.Decimal(3, 2)
  directReportAvgScore Decimal? @map("direct_report_avg_score") @db.Decimal(3, 2)

  // Evidence
  behavioralExamples  Json      @default("[]") @map("behavioral_examples")
  situationalResponses Json     @default("[]") @map("situational_responses")
  impactMetrics       Json      @default("{}") @map("impact_metrics")

  // Development
  strengths           Json      @default("[]") @map("strengths")
  developmentAreas    Json      @default("[]") @map("development_areas")
  actionPlan          String?   @map("action_plan")

  assessedAt          DateTime  @map("assessed_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User      @relation("UserLeadershipScores", fields: [userId], references: [id], onDelete: Cascade)
  competencyCategory  SkillCategory @relation(fields: [competencyCategoryId], references: [id])
  assessmentCycle     AssessmentCycle? @relation("CycleLeadershipAssessments", fields: [assessmentCycleId], references: [id])

  @@index([tenantId])
  @@index([userId])
  @@index([assessmentCycleId])
  @@index([competencyCategoryId])
  @@index([assessedAt])
  @@map("leadership_competency_scores")
}

// Feature 38: Behavioral Competency Scorer
model BehavioralCompetencyScore {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid
  assessmentCycleId   String?   @map("assessment_cycle_id") @db.Uuid
  competencyCategoryId String   @map("competency_category_id") @db.Uuid

  competencyName      String    @map("competency_name")

  // Core Behavioral Competencies
  communicationScore  Decimal?  @map("communication_score") @db.Decimal(3, 2)
  collaborationScore  Decimal?  @map("collaboration_score") @db.Decimal(3, 2)
  problemSolvingScore Decimal?  @map("problem_solving_score") @db.Decimal(3, 2)
  emotionalIntelligenceScore Decimal? @map("emotional_intelligence_score") @db.Decimal(3, 2)
  timeManagementScore Decimal?  @map("time_management_score") @db.Decimal(3, 2)
  initiativeScore     Decimal?  @map("initiative_score") @db.Decimal(3, 2)

  // AI-Powered Analysis
  interactionAnalysis Json      @default("{}") @map("interaction_analysis")
  sentimentTrends     Json      @default("[]") @map("sentiment_trends")
  communicationPatterns Json    @default("{}") @map("communication_patterns")
  collaborationMetrics Json     @default("{}") @map("collaboration_metrics")

  // Overall Score
  overallScore        Decimal   @map("overall_score") @db.Decimal(3, 2)
  scoreWeights        Json      @default("{}") @map("score_weights")
  confidence          Decimal?  @map("confidence") @db.Decimal(3, 2)

  // Evidence Sources
  observedBehaviors   Json      @default("[]") @map("observed_behaviors")
  peerFeedback        Json      @default("[]") @map("peer_feedback")
  managerObservations Json      @default("[]") @map("manager_observations")
  systemTrackedEvents Json      @default("[]") @map("system_tracked_events")

  // Tracking
  assessmentPeriodStart DateTime @map("assessment_period_start")
  assessmentPeriodEnd DateTime   @map("assessment_period_end")
  dataPointCount      Int       @default(0) @map("data_point_count")

  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User      @relation("UserBehavioralScores", fields: [userId], references: [id], onDelete: Cascade)
  competencyCategory  SkillCategory @relation(fields: [competencyCategoryId], references: [id])
  assessmentCycle     AssessmentCycle? @relation("CycleBehavioralAssessments", fields: [assessmentCycleId], references: [id])
  behaviorEvents      BehavioralTrackingEvent[]

  @@index([tenantId])
  @@index([userId])
  @@index([assessmentCycleId])
  @@index([competencyCategoryId])
  @@index([assessmentPeriodStart])
  @@map("behavioral_competency_scores")
}

model BehavioralTrackingEvent {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid
  competencyScoreId   String?   @map("competency_score_id") @db.Uuid

  eventType           String    @map("event_type")
  eventCategory       String    @map("event_category")
  competencyImpact    String[]  @map("competency_impact")

  // Event Data
  description         String?
  contextData         Json      @default("{}") @map("context_data")
  participants        String[]  @default([]) @db.Uuid

  // Scoring Impact
  positiveIndicator   Boolean   @default(true) @map("positive_indicator")
  impactWeight        Decimal   @default(1.0) @map("impact_weight") @db.Decimal(3, 2)
  confidenceScore     Decimal?  @map("confidence_score") @db.Decimal(3, 2)

  // Source
  sourceSystem        String?   @map("source_system")
  sourceReference     String?   @map("source_reference")
  capturedBy          String?   @map("captured_by") // SYSTEM, MANAGER, PEER, SELF

  eventTimestamp      DateTime  @map("event_timestamp")
  createdAt           DateTime  @default(now()) @map("created_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User      @relation("UserBehavioralEvents", fields: [userId], references: [id], onDelete: Cascade)
  competencyScore     BehavioralCompetencyScore? @relation(fields: [competencyScoreId], references: [id], onDelete: SetNull)

  @@index([tenantId])
  @@index([userId])
  @@index([competencyScoreId])
  @@index([eventType])
  @@index([eventTimestamp])
  @@map("behavioral_tracking_events")
}

// Feature 39: Compliance & Risk Assessment Module
model ComplianceAssessment {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String?   @map("user_id") @db.Uuid
  teamId              String?   @map("team_id") @db.Uuid
  departmentId        String?   @map("department_id") @db.Uuid

  assessmentType      String    @map("assessment_type")
  assessmentScope     String    @map("assessment_scope") // USER, TEAM, DEPARTMENT, ORGANIZATION

  // Policy Compliance
  policyId            String?   @map("policy_id") @db.Uuid
  policyVersion       String?   @map("policy_version")
  complianceStatus    String    @map("compliance_status") // COMPLIANT, NON_COMPLIANT, PARTIAL, PENDING
  complianceScore     Decimal?  @map("compliance_score") @db.Decimal(5, 2)

  // Violations
  violationCount      Int       @default(0) @map("violation_count")
  criticalViolations  Int       @default(0) @map("critical_violations")
  minorViolations     Int       @default(0) @map("minor_violations")
  violations          Json      @default("[]") @map("violations")

  // Risk Assessment
  riskLevel           String?   @map("risk_level") // LOW, MEDIUM, HIGH, CRITICAL
  riskScore           Decimal?  @map("risk_score") @db.Decimal(5, 2)
  riskFactors         Json      @default("[]") @map("risk_factors")
  potentialImpact     String?   @map("potential_impact")

  // Automated Detection
  autoDetected        Boolean   @default(false) @map("auto_detected")
  detectionRules      Json      @default("[]") @map("detection_rules")
  detectionConfidence Decimal?  @map("detection_confidence") @db.Decimal(3, 2)

  // Remediation
  remediationRequired Boolean   @default(false) @map("remediation_required")
  remediationStatus   String?   @map("remediation_status")
  remediationPlan     String?   @map("remediation_plan")
  remediationDeadline DateTime? @map("remediation_deadline")
  remediatedAt        DateTime? @map("remediated_at")
  remediatedBy        String?   @map("remediated_by") @db.Uuid

  // Period
  assessmentPeriodStart DateTime @map("assessment_period_start")
  assessmentPeriodEnd DateTime   @map("assessment_period_end")

  assessedBy          String?   @map("assessed_by") @db.Uuid
  assessedAt          DateTime  @map("assessed_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?     @relation("UserComplianceAssessments", fields: [userId], references: [id], onDelete: Cascade)
  team                Team?     @relation("TeamComplianceAssessments", fields: [teamId], references: [id])
  department          Department? @relation("DepartmentComplianceAssessments", fields: [departmentId], references: [id])
  policy              CompliancePolicy? @relation(fields: [policyId], references: [id])
  assessor            User?     @relation("ComplianceAssessor", fields: [assessedBy], references: [id])
  remediator          User?     @relation("ComplianceRemediator", fields: [remediatedBy], references: [id])
  violationDetails    ComplianceViolation[]

  @@index([tenantId])
  @@index([userId])
  @@index([teamId])
  @@index([departmentId])
  @@index([policyId])
  @@index([complianceStatus])
  @@index([riskLevel])
  @@index([assessedAt])
  @@map("compliance_assessments")
}

model CompliancePolicy {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid

  policyName          String    @map("policy_name")
  policyCode          String    @map("policy_code")
  version             String    @default("1.0")
  description         String?

  // Policy Configuration
  policyType          String    @map("policy_type")
  applicableScope     String    @map("applicable_scope") // ALL, DEPARTMENT, TEAM, ROLE
  applicableEntities  Json      @default("[]") @map("applicable_entities")

  // Rules
  complianceRules     Json      @default("[]") @map("compliance_rules")
  violationDefinitions Json     @default("[]") @map("violation_definitions")
  automatedChecks     Json      @default("[]") @map("automated_checks")

  // Enforcement
  enforcementLevel    String    @default("ADVISORY") @map("enforcement_level") // ADVISORY, MANDATORY, CRITICAL
  gracePeriodDays     Int       @default(0) @map("grace_period_days")
  escalationRules     Json      @default("[]") @map("escalation_rules")

  // Status
  status              String    @default("DRAFT") // DRAFT, ACTIVE, ARCHIVED
  effectiveDate       DateTime? @map("effective_date")
  expirationDate      DateTime? @map("expiration_date")

  createdBy           String    @map("created_by") @db.Uuid
  approvedBy          String?   @map("approved_by") @db.Uuid
  approvedAt          DateTime? @map("approved_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator             User      @relation("PolicyCreator", fields: [createdBy], references: [id])
  approver            User?     @relation("PolicyApprover", fields: [approvedBy], references: [id])
  assessments         ComplianceAssessment[]

  @@unique([tenantId, policyCode, version])
  @@index([tenantId])
  @@index([policyType])
  @@index([status])
  @@index([effectiveDate])
  @@map("compliance_policies")
}

model ComplianceViolation {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  assessmentId        String    @map("assessment_id") @db.Uuid
  userId              String?   @map("user_id") @db.Uuid

  violationType       String    @map("violation_type")
  severity            String    @map("severity") // CRITICAL, HIGH, MEDIUM, LOW

  ruleViolated        String    @map("rule_violated")
  description         String
  detectionMethod     String    @map("detection_method") // AUTOMATED, MANUAL, REPORTED

  // Evidence
  evidenceData        Json      @default("{}") @map("evidence_data")
  evidenceLinks       Json      @default("[]") @map("evidence_links")

  // Status
  status              String    @default("OPEN") // OPEN, ACKNOWLEDGED, IN_REMEDIATION, RESOLVED, DISMISSED
  acknowledgedAt      DateTime? @map("acknowledged_at")
  acknowledgedBy      String?   @map("acknowledged_by") @db.Uuid
  resolvedAt          DateTime? @map("resolved_at")
  resolvedBy          String?   @map("resolved_by") @db.Uuid
  resolutionNotes     String?   @map("resolution_notes")

  detectedAt          DateTime  @map("detected_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assessment          ComplianceAssessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  user                User?     @relation("ViolationUser", fields: [userId], references: [id], onDelete: Cascade)
  acknowledger        User?     @relation("ViolationAcknowledger", fields: [acknowledgedBy], references: [id])
  resolver            User?     @relation("ViolationResolver", fields: [resolvedBy], references: [id])

  @@index([tenantId])
  @@index([assessmentId])
  @@index([userId])
  @@index([severity])
  @@index([status])
  @@index([detectedAt])
  @@map("compliance_violations")
}

// Feature 40: Innovation Contribution Tracker
model InnovationContribution {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid

  title               String
  description         String
  innovationType      String    @map("innovation_type") // PROCESS_IMPROVEMENT, NEW_FEATURE, COST_REDUCTION, EFFICIENCY_GAIN, TECHNOLOGY_ADOPTION
  category            String?

  // Submission
  submittedAt         DateTime  @map("submitted_at")
  status              String    @default("SUBMITTED") // SUBMITTED, UNDER_REVIEW, APPROVED, IMPLEMENTED, REJECTED, ON_HOLD

  // Impact Assessment
  expectedImpact      String?   @map("expected_impact")
  actualImpact        String?   @map("actual_impact")
  impactMetrics       Json      @default("{}") @map("impact_metrics")

  // Quantifiable Benefits
  costSavings         Decimal?  @map("cost_savings") @db.Decimal(15, 2)
  timeSavings         Decimal?  @map("time_savings") @db.Decimal(10, 2) // in hours
  qualityImprovement  Decimal?  @map("quality_improvement") @db.Decimal(5, 2)
  customerSatisfaction Decimal? @map("customer_satisfaction") @db.Decimal(3, 2)

  // Scoring
  innovationScore     Decimal?  @map("innovation_score") @db.Decimal(5, 2)
  impactScore         Decimal?  @map("impact_score") @db.Decimal(5, 2)
  feasibilityScore    Decimal?  @map("feasibility_score") @db.Decimal(5, 2)
  overallScore        Decimal?  @map("overall_score") @db.Decimal(5, 2)

  // Implementation
  implementationStatus String?  @map("implementation_status")
  implementationDate  DateTime? @map("implementation_date")
  implementationTeam  Json      @default("[]") @map("implementation_team")
  implementationCost  Decimal?  @map("implementation_cost") @db.Decimal(15, 2)

  // Recognition
  recognitionLevel    String?   @map("recognition_level") // TEAM, DEPARTMENT, ORGANIZATION, EXTERNAL
  awards              Json      @default("[]") @map("awards")
  shareableAsCase     Boolean   @default(false) @map("shareable_as_case")

  // Collaboration
  collaborators       String[]  @default([]) @map("collaborators") @db.Uuid
  sponsors            String[]  @default([]) @map("sponsors") @db.Uuid

  // Review
  reviewedBy          String?   @map("reviewed_by") @db.Uuid
  reviewedAt          DateTime? @map("reviewed_at")
  reviewNotes         String?   @map("review_notes")

  // Attachments
  attachments         Json      @default("[]") @map("attachments")
  relatedProjects     Json      @default("[]") @map("related_projects")

  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  contributor         User      @relation("InnovationContributor", fields: [userId], references: [id], onDelete: Cascade)
  reviewer            User?     @relation("InnovationReviewer", fields: [reviewedBy], references: [id])
  evaluationDetails   InnovationEvaluation[]

  @@index([tenantId])
  @@index([userId])
  @@index([innovationType])
  @@index([status])
  @@index([submittedAt])
  @@map("innovation_contributions")
}

model InnovationEvaluation {
  id                  String    @id @default(uuid()) @db.Uuid
  contributionId      String    @map("contribution_id") @db.Uuid
  evaluatorId         String    @map("evaluator_id") @db.Uuid

  evaluatorRole       String    @map("evaluator_role") // MANAGER, PEER, TECHNICAL_EXPERT, EXECUTIVE

  // Evaluation Criteria
  noveltyScore        Decimal   @map("novelty_score") @db.Decimal(3, 2)
  feasibilityScore    Decimal   @map("feasibility_score") @db.Decimal(3, 2)
  impactScore         Decimal   @map("impact_score") @db.Decimal(3, 2)
  scalabilityScore    Decimal   @map("scalability_score") @db.Decimal(3, 2)
  alignmentScore      Decimal   @map("alignment_score") @db.Decimal(3, 2)

  overallScore        Decimal   @map("overall_score") @db.Decimal(3, 2)

  // Feedback
  strengths           Json      @default("[]") @map("strengths")
  concerns            Json      @default("[]") @map("concerns")
  suggestions         String?   @map("suggestions")
  recommendation      String?   @map("recommendation") // APPROVE, REJECT, NEEDS_MODIFICATION

  evaluatedAt         DateTime  @map("evaluated_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  contribution        InnovationContribution @relation(fields: [contributionId], references: [id], onDelete: Cascade)
  evaluator           User      @relation("InnovationEvaluator", fields: [evaluatorId], references: [id], onDelete: Cascade)

  @@unique([contributionId, evaluatorId])
  @@index([contributionId])
  @@index([evaluatorId])
  @@map("innovation_evaluations")
}

// Assessment Cycle (Unified cycle management for all assessments)
model AssessmentCycle {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid

  name                String
  cycleType           String    @map("cycle_type") // TECHNICAL, PROJECT, LEADERSHIP, BEHAVIORAL, COMPREHENSIVE
  fiscalYear          Int?      @map("fiscal_year")
  quarter             Int?

  // Timeline
  startDate           DateTime  @map("start_date")
  endDate             DateTime  @map("end_date")
  assessmentDeadline  DateTime? @map("assessment_deadline")

  // Configuration
  enabledAssessments  Json      @default("[]") @map("enabled_assessments")
  assessmentWeights   Json      @default("{}") @map("assessment_weights")

  // Status
  status              String    @default("DRAFT") // DRAFT, ACTIVE, IN_REVIEW, COMPLETED, ARCHIVED
  participantCount    Int       @default(0) @map("participant_count")
  completionRate      Decimal?  @map("completion_rate") @db.Decimal(5, 2)

  createdBy           String    @map("created_by") @db.Uuid
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator             User      @relation("CycleCreator", fields: [createdBy], references: [id])
  technicalAssessments TechnicalSkillAssessment[] @relation("CycleTechnicalAssessments")
  projectEvaluations  ProjectEvaluation[] @relation("CycleProjectEvaluations")
  leadershipAssessments LeadershipCompetencyScore[] @relation("CycleLeadershipAssessments")
  behavioralAssessments BehavioralCompetencyScore[] @relation("CycleBehavioralAssessments")

  @@index([tenantId])
  @@index([cycleType])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@map("assessment_cycles")
}

// ============================================================================
// AI-DRIVEN INSIGHTS & INTELLIGENCE ENGINE (Features 41-45)
// ============================================================================

// Feature 41: Sentiment Analysis of Work Communications
model SentimentAnalysis {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid

  // Source Information
  sourceType          String    @map("source_type") // EMAIL, SLACK, TEAMS, REVIEW, FEEDBACK
  sourceId            String?   @map("source_id") @db.Uuid
  sourceReference     String?   @map("source_reference")
  contentSample       String?   @map("content_sample") // First 200 chars for reference

  // Sentiment Scores
  sentimentScore      Decimal   @map("sentiment_score") @db.Decimal(4, 3) // -1.0 to 1.0
  sentimentLabel      String    @map("sentiment_label") // VERY_NEGATIVE, NEGATIVE, NEUTRAL, POSITIVE, VERY_POSITIVE
  confidence          Decimal   @map("confidence") @db.Decimal(3, 2)

  // Emotion Analysis
  emotions            Json      @default("{}") @map("emotions") // {joy: 0.8, anger: 0.1, ...}
  dominantEmotion     String?   @map("dominant_emotion")

  // Topic & Intent
  topics              String[]  @default([]) @map("topics")
  intent              String?   @map("intent") // QUESTION, COMPLAINT, PRAISE, REQUEST, etc.

  // Context
  recipientIds        String[]  @default([]) @map("recipient_ids") @db.Uuid
  context             Json      @default("{}") @map("context")

  // Model Information
  modelVersion        String    @map("model_version")
  modelType           String    @map("model_type") // TRANSFORMER, LSTM, etc.
  processingTime      Int?      @map("processing_time") // milliseconds

  analyzedAt          DateTime  @map("analyzed_at")
  createdAt           DateTime  @default(now()) @map("created_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User      @relation("UserSentimentAnalysis", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([sourceType])
  @@index([sentimentLabel])
  @@index([analyzedAt])
  @@index([dominantEmotion])
  @@map("sentiment_analyses")
}

model SentimentTrend {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid

  // Period
  periodType          String    @map("period_type") // DAILY, WEEKLY, MONTHLY
  periodStart         DateTime  @map("period_start")
  periodEnd           DateTime  @map("period_end")

  // Aggregated Scores
  avgSentimentScore   Decimal   @map("avg_sentiment_score") @db.Decimal(4, 3)
  minSentimentScore   Decimal   @map("min_sentiment_score") @db.Decimal(4, 3)
  maxSentimentScore   Decimal   @map("max_sentiment_score") @db.Decimal(4, 3)
  sentimentVolatility Decimal   @map("sentiment_volatility") @db.Decimal(4, 3)

  // Distribution
  sentimentDistribution Json    @default("{}") @map("sentiment_distribution")
  emotionDistribution Json      @default("{}") @map("emotion_distribution")

  // Trend Analysis
  trendDirection      String?   @map("trend_direction") // IMPROVING, DECLINING, STABLE
  changeFromPrevious  Decimal?  @map("change_from_previous") @db.Decimal(4, 3)

  // Statistics
  analysisCount       Int       @map("analysis_count")
  sourceBreakdown     Json      @default("{}") @map("source_breakdown")

  computedAt          DateTime  @map("computed_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User      @relation("UserSentimentTrends", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tenantId, userId, periodType, periodStart])
  @@index([tenantId])
  @@index([userId])
  @@index([periodType])
  @@index([periodStart])
  @@index([trendDirection])
  @@map("sentiment_trends")
}

// Feature 42: Productivity Prediction Engine
model ProductivityPrediction {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  entityType          String    @map("entity_type") // USER, TEAM, DEPARTMENT
  entityId            String    @map("entity_id") @db.Uuid

  // Prediction
  predictionType      String    @map("prediction_type") // DAILY, WEEKLY, MONTHLY, QUARTERLY
  predictionDate      DateTime  @map("prediction_date")
  predictedScore      Decimal   @map("predicted_score") @db.Decimal(5, 2)
  confidence          Decimal   @map("confidence") @db.Decimal(3, 2)
  confidenceInterval  Json      @map("confidence_interval") // {lower: X, upper: Y}

  // Feature Values Used
  features            Json      @map("features")
  featureImportance   Json      @map("feature_importance")

  // Actual vs Predicted (populated after actual data available)
  actualScore         Decimal?  @map("actual_score") @db.Decimal(5, 2)
  predictionError     Decimal?  @map("prediction_error") @db.Decimal(5, 2)
  errorPercentage     Decimal?  @map("error_percentage") @db.Decimal(5, 2)

  // Factors & Insights
  positiveFactors     Json      @default("[]") @map("positive_factors")
  negativeFactors     Json      @default("[]") @map("negative_factors")
  recommendations     Json      @default("[]") @map("recommendations")

  // Model Information
  modelVersion        String    @map("model_version")
  modelType           String    @map("model_type") // LINEAR_REGRESSION, RANDOM_FOREST, LSTM, etc.
  modelAccuracy       Decimal?  @map("model_accuracy") @db.Decimal(3, 2)

  predictedAt         DateTime  @map("predicted_at")
  validatedAt         DateTime? @map("validated_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([entityType, entityId])
  @@index([predictionType])
  @@index([predictionDate])
  @@index([predictedAt])
  @@map("productivity_predictions")
}

model ProductivityFeature {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  entityType          String    @map("entity_type")
  entityId            String    @map("entity_id") @db.Uuid

  // Feature Data
  featureDate         DateTime  @map("feature_date")
  featureType         String    @map("feature_type") // ACTIVITY, WORKLOAD, COLLABORATION, etc.

  // Raw Features
  features            Json      @map("features")

  // Engineered Features
  engineeredFeatures  Json      @default("{}") @map("engineered_features")

  // Target Variable (actual productivity for this date)
  targetValue         Decimal?  @map("target_value") @db.Decimal(5, 2)

  extractedAt         DateTime  @map("extracted_at")
  createdAt           DateTime  @default(now()) @map("created_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, entityType, entityId, featureDate, featureType])
  @@index([tenantId])
  @@index([entityType, entityId])
  @@index([featureDate])
  @@map("productivity_features")
}

// Feature 43: Engagement Scoring Algorithm
model EngagementScore {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid

  // Score
  overallScore        Decimal   @map("overall_score") @db.Decimal(5, 2)
  scoreLevel          String    @map("score_level") // VERY_LOW, LOW, MODERATE, HIGH, VERY_HIGH

  // Component Scores
  participationScore  Decimal   @map("participation_score") @db.Decimal(5, 2)
  communicationScore  Decimal   @map("communication_score") @db.Decimal(5, 2)
  collaborationScore  Decimal   @map("collaboration_score") @db.Decimal(5, 2)
  initiativeScore     Decimal   @map("initiative_score") @db.Decimal(5, 2)
  responsivenessScore Decimal   @map("responsiveness_score") @db.Decimal(5, 2)

  // Activity Metrics
  activityMetrics     Json      @map("activity_metrics")
  engagementPatterns  Json      @map("engagement_patterns")

  // Trend Analysis
  trendDirection      String?   @map("trend_direction")
  changeFromPrevious  Decimal?  @map("change_from_previous") @db.Decimal(5, 2)
  weekOverWeekChange  Decimal?  @map("week_over_week_change") @db.Decimal(5, 2)

  // Risk Indicators
  riskFactors         Json      @default("[]") @map("risk_factors")
  atRisk              Boolean   @default(false) @map("at_risk")
  riskLevel           String?   @map("risk_level")

  // Period
  scoreDate           DateTime  @map("score_date")
  calculationPeriod   String    @map("calculation_period") // REAL_TIME, DAILY, WEEKLY

  calculatedAt        DateTime  @map("calculated_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User      @relation("UserEngagementScores", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tenantId, userId, scoreDate, calculationPeriod])
  @@index([tenantId])
  @@index([userId])
  @@index([scoreLevel])
  @@index([scoreDate])
  @@index([atRisk])
  @@map("engagement_scores")
}

model EngagementEvent {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid

  eventType           String    @map("event_type")
  eventCategory       String    @map("event_category") // PARTICIPATION, COMMUNICATION, COLLABORATION, etc.

  // Event Data
  eventData           Json      @default("{}") @map("event_data")
  engagementImpact    Decimal   @map("engagement_impact") @db.Decimal(3, 2)
  positiveIndicator   Boolean   @map("positive_indicator")

  // Context
  sourceSystem        String?   @map("source_system")
  sourceReference     String?   @map("source_reference")

  eventTimestamp      DateTime  @map("event_timestamp")
  processedAt         DateTime? @map("processed_at")
  createdAt           DateTime  @default(now()) @map("created_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User      @relation("UserEngagementEvents", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([eventType])
  @@index([eventCategory])
  @@index([eventTimestamp])
  @@map("engagement_events")
}

// Feature 44: Anomaly Detection & Risk Flagging
model AnomalyDetection {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  entityType          String    @map("entity_type") // USER, TEAM
  entityId            String    @map("entity_id") @db.Uuid

  // Anomaly Information
  anomalyType         String    @map("anomaly_type") // BURNOUT, DISENGAGEMENT, PERFORMANCE_DECLINE, etc.
  anomalyCategory     String    @map("anomaly_category") // PRODUCTIVITY, ENGAGEMENT, SENTIMENT, BEHAVIOR
  severity            String    @map("severity") // LOW, MEDIUM, HIGH, CRITICAL

  // Detection
  anomalyScore        Decimal   @map("anomaly_score") @db.Decimal(5, 2)
  confidenceScore     Decimal   @map("confidence_score") @db.Decimal(3, 2)
  detectionMethod     String    @map("detection_method") // ISOLATION_FOREST, LSTM, STATISTICAL, etc.

  // Metrics
  currentValue        Decimal?  @map("current_value") @db.Decimal(10, 2)
  expectedValue       Decimal?  @map("expected_value") @db.Decimal(10, 2)
  deviation           Decimal?  @map("deviation") @db.Decimal(10, 2)
  deviationPercentage Decimal?  @map("deviation_percentage") @db.Decimal(5, 2)

  // Context & Indicators
  indicators          Json      @map("indicators") // Specific signals that triggered detection
  contributingFactors Json      @default("[]") @map("contributing_factors")
  historicalContext   Json      @default("{}") @map("historical_context")

  // Risk Assessment
  riskLevel           String    @map("risk_level")
  impactAssessment    String?   @map("impact_assessment")
  urgency             String    @map("urgency") // IMMEDIATE, SOON, MONITOR

  // Recommendations
  recommendations     Json      @default("[]") @map("recommendations")
  suggestedActions    Json      @default("[]") @map("suggested_actions")

  // Status
  status              String    @default("ACTIVE") @map("status") // ACTIVE, ACKNOWLEDGED, INVESTIGATING, RESOLVED, FALSE_POSITIVE
  acknowledgedAt      DateTime? @map("acknowledged_at")
  acknowledgedBy      String?   @map("acknowledged_by") @db.Uuid
  resolvedAt          DateTime? @map("resolved_at")
  resolution          String?   @map("resolution")

  // Model Information
  modelVersion        String    @map("model_version")
  modelAccuracy       Decimal?  @map("model_accuracy") @db.Decimal(3, 2)

  detectedAt          DateTime  @map("detected_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  acknowledger        User?     @relation("AnomalyAcknowledger2", fields: [acknowledgedBy], references: [id])

  @@index([tenantId])
  @@index([entityType, entityId])
  @@index([anomalyType])
  @@index([severity])
  @@index([status])
  @@index([detectedAt])
  @@map("anomaly_detections")
}

model AnomalyPattern {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid

  patternName         String    @map("pattern_name")
  patternType         String    @map("pattern_type") // BURNOUT, DISENGAGEMENT, etc.
  description         String?

  // Pattern Definition
  indicators          Json      @map("indicators") // Rules and thresholds
  detectionRules      Json      @map("detection_rules")
  thresholds          Json      @map("thresholds")

  // Configuration
  isActive            Boolean   @default(true) @map("is_active")
  severity            String    @map("severity")
  sensitivity         Decimal   @default(0.7) @map("sensitivity") @db.Decimal(3, 2)

  // Statistics
  detectionCount      Int       @default(0) @map("detection_count")
  falsePositiveRate   Decimal?  @map("false_positive_rate") @db.Decimal(3, 2)
  accuracy            Decimal?  @map("accuracy") @db.Decimal(3, 2)

  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([patternType])
  @@index([isActive])
  @@map("anomaly_patterns")
}

// Feature 45: AI-Powered Performance Benchmarking
model PerformanceBenchmark {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid

  // Benchmark Definition
  benchmarkName       String    @map("benchmark_name")
  benchmarkType       String    @map("benchmark_type") // ROLE, DEPARTMENT, LEVEL, INDUSTRY
  targetRole          String?   @map("target_role")
  targetDepartment    String?   @map("target_department") @db.Uuid
  targetLevel         Int?      @map("target_level")

  // Metrics
  metricName          String    @map("metric_name")
  metricCategory      String    @map("metric_category")

  // Statistical Benchmarks
  percentile25        Decimal   @map("percentile_25") @db.Decimal(10, 2)
  percentile50        Decimal   @map("percentile_50") @db.Decimal(10, 2)
  percentile75        Decimal   @map("percentile_75") @db.Decimal(10, 2)
  percentile90        Decimal   @map("percentile_90") @db.Decimal(10, 2)
  mean                Decimal   @map("mean") @db.Decimal(10, 2)
  standardDeviation   Decimal   @map("standard_deviation") @db.Decimal(10, 2)

  // Range
  minValue            Decimal   @map("min_value") @db.Decimal(10, 2)
  maxValue            Decimal   @map("max_value") @db.Decimal(10, 2)

  // Sample Information
  sampleSize          Int       @map("sample_size")
  dataPoints          Int       @map("data_points")

  // Model Information
  modelVersion        String    @map("model_version")
  computationMethod   String    @map("computation_method")

  // Validity
  validFrom           DateTime  @map("valid_from")
  validUntil          DateTime  @map("valid_until")
  isActive            Boolean   @default(true) @map("is_active")

  computedAt          DateTime  @map("computed_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  comparisons         PerformanceComparison[]

  @@unique([tenantId, benchmarkType, targetRole, targetDepartment, targetLevel, metricName, validFrom])
  @@index([tenantId])
  @@index([benchmarkType])
  @@index([targetRole])
  @@index([metricName])
  @@index([isActive])
  @@map("performance_benchmarks")
}

model PerformanceComparison {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  userId              String    @map("user_id") @db.Uuid
  benchmarkId         String    @map("benchmark_id") @db.Uuid

  // User Performance
  userValue           Decimal   @map("user_value") @db.Decimal(10, 2)
  benchmarkValue      Decimal   @map("benchmark_value") @db.Decimal(10, 2)

  // Comparison
  percentileRank      Decimal   @map("percentile_rank") @db.Decimal(5, 2)
  deviationFromMean   Decimal   @map("deviation_from_mean") @db.Decimal(10, 2)
  zScore              Decimal   @map("z_score") @db.Decimal(5, 2)

  // Classification
  performanceLevel    String    @map("performance_level") // BELOW, AT, ABOVE, EXCEPTIONAL
  relativePosition    String    @map("relative_position") // BOTTOM_10, BOTTOM_25, MIDDLE_50, TOP_25, TOP_10

  // Insights
  strengths           Json      @default("[]") @map("strengths")
  improvementAreas    Json      @default("[]") @map("improvement_areas")
  recommendations     Json      @default("[]") @map("recommendations")

  comparisonDate      DateTime  @map("comparison_date")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User      @relation("UserPerformanceComparisons", fields: [userId], references: [id], onDelete: Cascade)
  benchmark           PerformanceBenchmark @relation(fields: [benchmarkId], references: [id], onDelete: Cascade)

  @@unique([tenantId, userId, benchmarkId, comparisonDate])
  @@index([tenantId])
  @@index([userId])
  @@index([benchmarkId])
  @@index([performanceLevel])
  @@index([comparisonDate])
  @@map("performance_comparisons")
}

// ML Model Management
model MLModel {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid

  modelName           String    @map("model_name")
  modelType           String    @map("model_type") // SENTIMENT, PRODUCTIVITY, ENGAGEMENT, ANOMALY, BENCHMARK
  modelCategory       String    @map("model_category") // CLASSIFICATION, REGRESSION, CLUSTERING, etc.

  // Version & Deployment
  version             String    @map("version")
  status              String    @map("status") // TRAINING, TESTING, PRODUCTION, DEPRECATED
  deployedAt          DateTime? @map("deployed_at")

  // Model Configuration
  algorithm           String    @map("algorithm")
  hyperparameters     Json      @map("hyperparameters")
  features            Json      @map("features")

  // Training Information
  trainingDataSize    Int?      @map("training_data_size")
  trainingStarted     DateTime? @map("training_started")
  trainingCompleted   DateTime? @map("training_completed")
  trainingDuration    Int?      @map("training_duration") // seconds

  // Performance Metrics
  accuracy            Decimal?  @map("accuracy") @db.Decimal(5, 4)
  precision           Decimal?  @map("precision") @db.Decimal(5, 4)
  recall              Decimal?  @map("recall") @db.Decimal(5, 4)
  f1Score             Decimal?  @map("f1_score") @db.Decimal(5, 4)
  rSquared            Decimal?  @map("r_squared") @db.Decimal(5, 4)
  mae                 Decimal?  @map("mae") @db.Decimal(10, 4)
  rmse                Decimal?  @map("rmse") @db.Decimal(10, 4)

  // Additional Metrics
  customMetrics       Json      @default("{}") @map("custom_metrics")

  // Model Artifacts
  modelPath           String?   @map("model_path")
  artifactSize        Int?      @map("artifact_size") // bytes
  checksum            String?   @map("checksum")

  // Documentation
  description         String?
  trainingNotes       String?   @map("training_notes")
  limitations         String?   @map("limitations")

  createdBy           String    @map("created_by") @db.Uuid
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator             User      @relation("MLModelCreator", fields: [createdBy], references: [id])
  predictions         ModelPrediction[]
  controlExperiments  ABTestExperiment[] @relation("ControlModel")
  variantExperiments  ABTestExperiment[] @relation("VariantModel")

  @@unique([tenantId, modelName, version])
  @@index([tenantId])
  @@index([modelType])
  @@index([status])
  @@map("ml_models")
}

model ModelPrediction {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid
  modelId             String    @map("model_id") @db.Uuid

  // Prediction
  predictionType      String    @map("prediction_type")
  inputFeatures       Json      @map("input_features")
  prediction          Json      @map("prediction")
  confidence          Decimal?  @map("confidence") @db.Decimal(3, 2)

  // Validation
  actualOutcome       Json?     @map("actual_outcome")
  isCorrect           Boolean?  @map("is_correct")
  error               Decimal?  @map("error") @db.Decimal(10, 4)

  // Performance
  inferenceTime       Int       @map("inference_time") // milliseconds

  predictedAt         DateTime  @map("predicted_at")
  validatedAt         DateTime? @map("validated_at")
  createdAt           DateTime  @default(now()) @map("created_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  model               MLModel   @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([modelId])
  @@index([predictionType])
  @@index([predictedAt])
  @@map("model_predictions")
}

// A/B Testing Framework
model ABTestExperiment {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid

  experimentName      String    @map("experiment_name")
  description         String?
  hypothesis          String?

  // Models Being Tested
  controlModelId      String    @map("control_model_id") @db.Uuid
  variantModelId      String    @map("variant_model_id") @db.Uuid

  // Configuration
  trafficSplit        Decimal   @default(0.5) @map("traffic_split") @db.Decimal(3, 2) // % to variant
  targetMetric        String    @map("target_metric")
  successCriteria     Json      @map("success_criteria")

  // Status
  status              String    @default("DRAFT") @map("status") // DRAFT, RUNNING, PAUSED, COMPLETED
  startDate           DateTime? @map("start_date")
  endDate             DateTime? @map("end_date")

  // Results
  controlMetrics      Json?     @map("control_metrics")
  variantMetrics      Json?     @map("variant_metrics")
  statisticalSignificance Decimal? @map("statistical_significance") @db.Decimal(5, 4)
  winner              String?   @map("winner") // CONTROL, VARIANT, INCONCLUSIVE

  // Sample Size
  targetSampleSize    Int?      @map("target_sample_size")
  currentSampleSize   Int       @default(0) @map("current_sample_size")

  createdBy           String    @map("created_by") @db.Uuid
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  controlModel        MLModel   @relation("ControlModel", fields: [controlModelId], references: [id])
  variantModel        MLModel   @relation("VariantModel", fields: [variantModelId], references: [id])
  creator             User      @relation("ABTestCreator", fields: [createdBy], references: [id])

  @@index([tenantId])
  @@index([status])
  @@index([controlModelId])
  @@index([variantModelId])
  @@map("ab_test_experiments")
}

model FeatureStore {
  id                  String    @id @default(uuid()) @db.Uuid
  tenantId            String    @map("tenant_id") @db.Uuid

  featureName         String    @map("feature_name")
  featureGroup        String    @map("feature_group")
  description         String?

  // Feature Definition
  dataType            String    @map("data_type") // NUMERIC, CATEGORICAL, BOOLEAN, TEXT
  computationMethod   String    @map("computation_method")
  transformations     Json      @default("[]") @map("transformations")

  // Statistics
  minValue            Decimal?  @map("min_value") @db.Decimal(15, 4)
  maxValue            Decimal?  @map("max_value") @db.Decimal(15, 4)
  meanValue           Decimal?  @map("mean_value") @db.Decimal(15, 4)
  stdDeviation        Decimal?  @map("std_deviation") @db.Decimal(15, 4)

  // Usage
  usedByModels        String[]  @map("used_by_models") @db.Uuid
  importance          Decimal?  @map("importance") @db.Decimal(5, 4)

  // Metadata
  version             String    @default("1.0") @map("version")
  isActive            Boolean   @default(true) @map("is_active")

  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, featureName, version])
  @@index([tenantId])
  @@index([featureGroup])
  @@index([isActive])
  @@map("feature_store")
}

// ============================================================================
// ACTIONABLE INSIGHTS & PLANNING TOOLS (Features 46-50)
// ============================================================================

// Feature 46: Automated Promotion & Succession Recommendation System
model PromotionRecommendation {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  userId                String    @map("user_id") @db.Uuid
  targetRole            String    @map("target_role")
  targetLevel           String?   @map("target_level")
  targetDepartment      String?   @map("target_department") @db.Uuid

  // Recommendation Scoring
  overallScore          Decimal   @map("overall_score") @db.Decimal(5, 2)
  readinessLevel        String    @map("readiness_level") // READY_NOW, READY_1_YEAR, READY_2_YEARS, NEEDS_DEVELOPMENT
  confidenceScore       Decimal   @map("confidence_score") @db.Decimal(3, 2)

  // Component Scores
  performanceScore      Decimal   @map("performance_score") @db.Decimal(5, 2)
  potentialScore        Decimal   @map("potential_score") @db.Decimal(5, 2)
  skillsMatchScore      Decimal   @map("skills_match_score") @db.Decimal(5, 2)
  leadershipScore       Decimal   @map("leadership_score") @db.Decimal(5, 2)
  tenureScore           Decimal   @map("tenure_score") @db.Decimal(5, 2)
  engagementScore       Decimal   @map("engagement_score") @db.Decimal(5, 2)

  // Analysis
  strengths             String[]  @default([]) @map("strengths")
  developmentNeeds      String[]  @default([]) @map("development_needs")
  skillGaps             Json      @default("{}") @map("skill_gaps")
  careerTrajectory      String?   @map("career_trajectory") @db.Text
  riskFactors           String[]  @default([]) @map("risk_factors")

  // Recommendations
  developmentActions    Json      @default("[]") @map("development_actions")
  timeline              String?   @map("timeline")
  estimatedTimeToReady  Int?      @map("estimated_time_to_ready") // months
  successProbability    Decimal?  @map("success_probability") @db.Decimal(3, 2)

  // Workflow & Status
  status                String    @default("PENDING") @map("status") // PENDING, UNDER_REVIEW, APPROVED, REJECTED, IMPLEMENTED
  reviewedBy            String?   @map("reviewed_by") @db.Uuid
  reviewedAt            DateTime? @map("reviewed_at")
  approvedBy            String?   @map("approved_by") @db.Uuid
  approvedAt            DateTime? @map("approved_at")
  rejectionReason       String?   @map("rejection_reason") @db.Text
  implementedAt         DateTime? @map("implemented_at")

  // Metadata
  recommendationType    String    @map("recommendation_type") // PROMOTION, LATERAL_MOVE, SUCCESSION
  modelVersion          String    @map("model_version")
  generatedAt           DateTime  @default(now()) @map("generated_at")
  expiresAt             DateTime? @map("expires_at")

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                  User      @relation("UserPromotionRecommendations", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, userId])
  @@index([status])
  @@index([readinessLevel])
  @@index([targetRole])
  @@index([generatedAt])
  @@map("promotion_recommendations")
}

model SuccessionPlan {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  positionId            String    @map("position_id") @db.Uuid
  positionTitle         String    @map("position_title")
  currentIncumbent      String?   @map("current_incumbent") @db.Uuid
  criticality           String    @map("criticality") // CRITICAL, HIGH, MEDIUM, LOW

  // Risk Assessment
  retirementRisk        Boolean   @default(false) @map("retirement_risk")
  turnoverRisk          String?   @map("turnover_risk") // HIGH, MEDIUM, LOW
  vacancyImpact         String    @map("vacancy_impact") // SEVERE, SIGNIFICANT, MODERATE, MINIMAL
  timeToFill            Int?      @map("time_to_fill") // days

  // Succession Pool
  successors            Json      @default("[]") @map("successors") // Array of {userId, readiness, probability}
  emergencyBackup       String?   @map("emergency_backup") @db.Uuid
  interimOptions        String[]  @default([]) @map("interim_options") @db.Uuid

  // Development
  developmentPipeline   Json      @default("[]") @map("development_pipeline")
  benchStrength         Int       @default(0) @map("bench_strength") // Number of ready successors

  // Planning
  reviewFrequency       String    @default("QUARTERLY") @map("review_frequency")
  lastReviewedAt        DateTime? @map("last_reviewed_at")
  nextReviewDate        DateTime? @map("next_review_date")

  // Status
  status                String    @default("ACTIVE") @map("status")
  notes                 String?   @map("notes") @db.Text

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, positionId])
  @@index([criticality])
  @@index([status])
  @@map("succession_plans")
}

// Feature 47: Personalized Development Plan Generator
model DevelopmentPlan {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  userId                String    @map("user_id") @db.Uuid

  // Plan Overview
  planName              String    @map("plan_name")
  planType              String    @map("plan_type") // CAREER_GROWTH, SKILL_DEVELOPMENT, LEADERSHIP, PERFORMANCE_IMPROVEMENT
  duration              Int       @map("duration") // months
  startDate             DateTime  @map("start_date")
  targetCompletionDate  DateTime  @map("target_completion_date")

  // Career Objectives
  careerGoal            String    @map("career_goal") @db.Text
  targetRole            String?   @map("target_role")
  targetLevel           String?   @map("target_level")
  careerPath            Json      @default("[]") @map("career_path") // Array of milestones

  // Assessment
  currentLevel          String    @map("current_level")
  strengthsAssessed     String[]  @default([]) @map("strengths_assessed")
  developmentAreas      String[]  @default([]) @map("development_areas")
  skillGapAnalysis      Json      @default("{}") @map("skill_gap_analysis")
  competencyGaps        Json      @default("{}") @map("competency_gaps")

  // Development Activities
  activities            Json      @default("[]") @map("activities") // Array of development activities
  totalActivities       Int       @default(0) @map("total_activities")
  completedActivities   Int       @default(0) @map("completed_activities")

  // Skills & Competencies to Develop
  targetSkills          Json      @default("[]") @map("target_skills")
  targetCompetencies    Json      @default("[]") @map("target_competencies")
  certifications        String[]  @default([]) @map("certifications")

  // Resources
  learningResources     Json      @default("[]") @map("learning_resources")
  mentorAssigned        String?   @map("mentor_assigned") @db.Uuid
  coachAssigned         String?   @map("coach_assigned") @db.Uuid
  budget                Decimal?  @map("budget") @db.Decimal(10, 2)
  budgetSpent           Decimal   @default(0) @map("budget_spent") @db.Decimal(10, 2)

  // Progress Tracking
  progressPercentage    Decimal   @default(0) @map("progress_percentage") @db.Decimal(5, 2)
  milestones            Json      @default("[]") @map("milestones")
  milestonesAchieved    Int       @default(0) @map("milestones_achieved")

  // Evaluation
  evaluationCriteria    Json      @default("{}") @map("evaluation_criteria")
  successMetrics        Json      @default("[]") @map("success_metrics")
  checkpointDates       DateTime[] @default([]) @map("checkpoint_dates")

  // Status & Workflow
  status                String    @default("DRAFT") @map("status") // DRAFT, ACTIVE, ON_HOLD, COMPLETED, CANCELLED
  approvedBy            String?   @map("approved_by") @db.Uuid
  approvedAt            DateTime? @map("approved_at")
  completedAt           DateTime? @map("completed_at")

  // Generation Metadata
  generatedBy           String    @default("AI") @map("generated_by") // AI, MANUAL, HYBRID
  modelVersion          String?   @map("model_version")
  confidence            Decimal?  @map("confidence") @db.Decimal(3, 2)

  // Notes & Comments
  notes                 String?   @map("notes") @db.Text
  managerNotes          String?   @map("manager_notes") @db.Text

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                  User      @relation("UserDevelopmentPlans", fields: [userId], references: [id], onDelete: Cascade)
  activities_rel        DevelopmentActivity[]
  checkpoints           DevelopmentCheckpoint[]

  @@index([tenantId, userId])
  @@index([status])
  @@index([planType])
  @@index([startDate])
  @@map("development_plans")
}

model DevelopmentActivity {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  developmentPlanId     String    @map("development_plan_id") @db.Uuid
  userId                String    @map("user_id") @db.Uuid

  // Activity Details
  activityType          String    @map("activity_type") // TRAINING, COURSE, CERTIFICATION, MENTORING, PROJECT, SHADOWING, READING
  title                 String    @map("title")
  description           String    @map("description") @db.Text
  provider              String?   @map("provider")

  // Objectives
  learningObjectives    String[]  @default([]) @map("learning_objectives")
  targetSkills          String[]  @default([]) @map("target_skills")
  targetCompetencies    String[]  @default([]) @map("target_competencies")

  // Scheduling
  estimatedHours        Decimal?  @map("estimated_hours") @db.Decimal(6, 2)
  actualHours           Decimal?  @map("actual_hours") @db.Decimal(6, 2)
  dueDate               DateTime? @map("due_date")
  startDate             DateTime? @map("start_date")
  completionDate        DateTime? @map("completion_date")

  // Resources
  resourceUrl           String?   @map("resource_url")
  cost                  Decimal?  @map("cost") @db.Decimal(10, 2)
  location              String?   @map("location")

  // Tracking
  status                String    @default("NOT_STARTED") @map("status") // NOT_STARTED, IN_PROGRESS, COMPLETED, CANCELLED
  progressPercentage    Decimal   @default(0) @map("progress_percentage") @db.Decimal(5, 2)
  completionEvidence    String?   @map("completion_evidence") @db.Text
  certificateUrl        String?   @map("certificate_url")

  // Evaluation
  rating                Int?      @map("rating") // 1-5
  feedback              String?   @map("feedback") @db.Text
  impactAssessment      String?   @map("impact_assessment") @db.Text

  // Priority
  priority              String    @default("MEDIUM") @map("priority") // HIGH, MEDIUM, LOW
  isRequired            Boolean   @default(false) @map("is_required")

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  developmentPlan       DevelopmentPlan @relation(fields: [developmentPlanId], references: [id], onDelete: Cascade)
  user                  User      @relation("UserDevelopmentActivities", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, userId])
  @@index([developmentPlanId])
  @@index([status])
  @@index([dueDate])
  @@map("development_activities")
}

model DevelopmentCheckpoint {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  developmentPlanId     String    @map("development_plan_id") @db.Uuid
  userId                String    @map("user_id") @db.Uuid

  // Checkpoint Details
  checkpointName        String    @map("checkpoint_name")
  checkpointDate        DateTime  @map("checkpoint_date")
  checkpointType        String    @map("checkpoint_type") // MILESTONE, REVIEW, ASSESSMENT, COMPLETION

  // Evaluation
  progressReview        String?   @map("progress_review") @db.Text
  skillsAcquired        String[]  @default([]) @map("skills_acquired")
  competenciesImproved  Json      @default("{}") @map("competencies_improved")
  goalsAchieved         String[]  @default([]) @map("goals_achieved")

  // Feedback
  managerFeedback       String?   @map("manager_feedback") @db.Text
  selfAssessment        String?   @map("self_assessment") @db.Text
  peerFeedback          Json?     @map("peer_feedback")

  // Status
  status                String    @default("SCHEDULED") @map("status") // SCHEDULED, COMPLETED, SKIPPED
  completedAt           DateTime? @map("completed_at")
  conductedBy           String?   @map("conducted_by") @db.Uuid

  // Next Steps
  nextSteps             String[]  @default([]) @map("next_steps")
  adjustments           String?   @map("adjustments") @db.Text

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  developmentPlan       DevelopmentPlan @relation(fields: [developmentPlanId], references: [id], onDelete: Cascade)
  user                  User      @relation("UserDevelopmentCheckpoints", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, userId])
  @@index([developmentPlanId])
  @@index([checkpointDate])
  @@map("development_checkpoints")
}

model CareerPath {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid

  // Path Definition
  pathName              String    @map("path_name")
  pathDescription       String    @map("path_description") @db.Text
  startingRole          String    @map("starting_role")
  department            String?   @map("department")

  // Path Structure
  roles                 Json      @default("[]") @map("roles") // Array of role progression
  levels                Json      @default("[]") @map("levels") // Array of levels with requirements
  branches              Json      @default("[]") @map("branches") // Alternative paths

  // Requirements
  skillRequirements     Json      @default("{}") @map("skill_requirements")
  competencyRequirements Json     @default("{}") @map("competency_requirements")
  experienceRequirements Json     @default("{}") @map("experience_requirements")

  // Metadata
  averageDuration       Int?      @map("average_duration") // months
  successRate           Decimal?  @map("success_rate") @db.Decimal(5, 2)
  isActive              Boolean   @default(true) @map("is_active")

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([startingRole])
  @@map("career_paths")
}

// Feature 48: Team Formation & Restructuring Optimizer
model TeamOptimization {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid

  // Optimization Context
  optimizationType      String    @map("optimization_type") // NEW_TEAM, RESTRUCTURE, EXPANSION, REBALANCE
  targetTeamId          String?   @map("target_team_id") @db.Uuid
  teamName              String    @map("team_name")
  department            String?   @map("department")

  // Objectives
  objectives            Json      @default("[]") @map("objectives")
  constraints           Json      @default("{}") @map("constraints")
  requiredSkills        Json      @default("[]") @map("required_skills")
  requiredCompetencies  Json      @default("[]") @map("required_competencies")
  teamSize              Int       @map("team_size")

  // Recommendations
  recommendedMembers    Json      @default("[]") @map("recommended_members") // Array of {userId, role, score, rationale}
  alternativeOptions    Json      @default("[]") @map("alternative_options")

  // Scoring
  overallScore          Decimal   @map("overall_score") @db.Decimal(5, 2)
  skillCoverageScore    Decimal   @map("skill_coverage_score") @db.Decimal(5, 2)
  diversityScore        Decimal   @map("diversity_score") @db.Decimal(5, 2)
  collaborationScore    Decimal   @map("collaboration_score") @db.Decimal(5, 2)
  performanceScore      Decimal   @map("performance_score") @db.Decimal(5, 2)
  chemistryScore        Decimal?  @map("chemistry_score") @db.Decimal(5, 2)

  // Analysis
  strengthsAnalysis     String[]  @default([]) @map("strengths_analysis")
  risks                 String[]  @default([]) @map("risks")
  skillGaps             Json      @default("{}") @map("skill_gaps")
  redundancies          String[]  @default([]) @map("redundancies")

  // Recommendations
  recommendations       Json      @default("[]") @map("recommendations")
  implementationSteps   Json      @default("[]") @map("implementation_steps")
  estimatedImpact       String?   @map("estimated_impact") @db.Text

  // Workflow
  status                String    @default("PENDING") @map("status") // PENDING, UNDER_REVIEW, APPROVED, REJECTED, IMPLEMENTED
  reviewedBy            String?   @map("reviewed_by") @db.Uuid
  reviewedAt            DateTime? @map("reviewed_at")
  approvedBy            String?   @map("approved_by") @db.Uuid
  approvedAt            DateTime? @map("approved_at")
  implementedAt         DateTime? @map("implemented_at")

  // Metadata
  algorithmVersion      String    @map("algorithm_version")
  confidence            Decimal   @map("confidence") @db.Decimal(3, 2)

  notes                 String?   @map("notes") @db.Text

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([targetTeamId])
  @@index([status])
  @@map("team_optimizations")
}

model TeamCompositionAnalysis {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  teamId                String    @map("team_id") @db.Uuid

  // Analysis Period
  analysisDate          DateTime  @map("analysis_date")
  analysisPeriod        String    @map("analysis_period") // CURRENT, QUARTERLY, ANNUAL

  // Team Metrics
  teamSize              Int       @map("team_size")
  avgTenure             Decimal   @map("avg_tenure") @db.Decimal(6, 2) // months
  avgPerformanceScore   Decimal   @map("avg_performance_score") @db.Decimal(5, 2)

  // Diversity Metrics
  diversityMetrics      Json      @default("{}") @map("diversity_metrics")
  skillDistribution     Json      @default("{}") @map("skill_distribution")
  seniorityMix          Json      @default("{}") @map("seniority_mix")

  // Performance Metrics
  productivityScore     Decimal   @map("productivity_score") @db.Decimal(5, 2)
  collaborationScore    Decimal   @map("collaboration_score") @db.Decimal(5, 2)
  innovationScore       Decimal   @map("innovation_score") @db.Decimal(5, 2)

  // Health Indicators
  turnoverRisk          String    @map("turnover_risk") // HIGH, MEDIUM, LOW
  burnoutRisk           String    @map("burnout_risk") // HIGH, MEDIUM, LOW
  engagementLevel       String    @map("engagement_level") // HIGH, MEDIUM, LOW

  // Gaps & Strengths
  skillGaps             Json      @default("[]") @map("skill_gaps")
  skillSurplus          Json      @default("[]") @map("skill_surplus")
  keyStrengths          String[]  @default([]) @map("key_strengths")
  vulnerabilities       String[]  @default([]) @map("vulnerabilities")

  // Recommendations
  recommendations       Json      @default("[]") @map("recommendations")
  priorityActions       String[]  @default([]) @map("priority_actions")

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  team                  Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([tenantId, teamId])
  @@index([analysisDate])
  @@map("team_composition_analyses")
}

// Feature 49: Performance Improvement Plan (PIP) Automation
model PerformanceImprovementPlan {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  userId                String    @map("user_id") @db.Uuid
  createdBy             String    @map("created_by") @db.Uuid

  // PIP Overview
  pipTitle              String    @map("pip_title")
  pipType               String    @map("pip_type") // PERFORMANCE, BEHAVIOR, ATTENDANCE, SKILLS
  severity              String    @map("severity") // STANDARD, SERIOUS, FINAL_WARNING

  // Timeline
  startDate             DateTime  @map("start_date")
  endDate               DateTime  @map("end_date")
  duration              Int       @map("duration") // days
  reviewFrequency       String    @map("review_frequency") // WEEKLY, BI_WEEKLY, MONTHLY

  // Performance Issues
  performanceIssues     Json      @default("[]") @map("performance_issues")
  specificBehaviors     String[]  @default([]) @map("specific_behaviors")
  impactStatement       String    @map("impact_statement") @db.Text
  previousDiscussions   Json      @default("[]") @map("previous_discussions")

  // Expectations & Goals
  performanceExpectations String  @map("performance_expectations") @db.Text
  specificGoals         Json      @default("[]") @map("specific_goals")
  measurableObjectives  Json      @default("[]") @map("measurable_objectives")
  successCriteria       Json      @default("[]") @map("success_criteria")

  // Support & Resources
  supportProvided       Json      @default("[]") @map("support_provided")
  trainingRequired      String[]  @default([]) @map("training_required")
  mentorAssigned        String?   @map("mentor_assigned") @db.Uuid
  coachingSchedule      Json      @default("[]") @map("coaching_schedule")
  resources             Json      @default("[]") @map("resources")

  // Milestones & Check-ins
  milestones            Json      @default("[]") @map("milestones")
  checkInDates          DateTime[] @default([]) @map("check_in_dates")

  // Consequences
  consequencesOfNonCompliance String @map("consequences_of_non_compliance") @db.Text
  escalationPath        Json      @default("[]") @map("escalation_path")

  // Progress Tracking
  status                String    @default("ACTIVE") @map("status") // DRAFT, ACTIVE, ON_TRACK, AT_RISK, SUCCESSFUL, UNSUCCESSFUL, CANCELLED
  progressPercentage    Decimal   @default(0) @map("progress_percentage") @db.Decimal(5, 2)
  currentPhase          String?   @map("current_phase")

  // Outcomes
  outcome               String?   @map("outcome") // SUCCESSFUL, UNSUCCESSFUL, EXTENDED, TERMINATED
  outcomeDate           DateTime? @map("outcome_date")
  outcomeNotes          String?   @map("outcome_notes") @db.Text
  finalAssessment       String?   @map("final_assessment") @db.Text

  // Workflow
  hrApprovalRequired    Boolean   @default(true) @map("hr_approval_required")
  hrApprovedBy          String?   @map("hr_approved_by") @db.Uuid
  hrApprovedAt          DateTime? @map("hr_approved_at")
  employeeAcknowledged  Boolean   @default(false) @map("employee_acknowledged")
  acknowledgedAt        DateTime? @map("acknowledged_at")
  employeeComments      String?   @map("employee_comments") @db.Text

  // Generation
  generatedBy           String    @default("MANUAL") @map("generated_by") // MANUAL, AI, TEMPLATE
  templateUsed          String?   @map("template_used") @db.Uuid

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                  User      @relation("UserPIPs", fields: [userId], references: [id], onDelete: Cascade)
  checkIns              PIPCheckIn[]
  milestoneProgress     PIPMilestone[]

  @@index([tenantId, userId])
  @@index([status])
  @@index([startDate])
  @@map("performance_improvement_plans")
}

model PIPCheckIn {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  pipId                 String    @map("pip_id") @db.Uuid
  userId                String    @map("user_id") @db.Uuid

  // Check-in Details
  checkInDate           DateTime  @map("check_in_date")
  checkInType           String    @map("check_in_type") // SCHEDULED, AD_HOC, MILESTONE
  conductedBy           String    @map("conducted_by") @db.Uuid

  // Progress Review
  progressSummary       String    @map("progress_summary") @db.Text
  goalsMetStatus        Json      @default("{}") @map("goals_met_status")
  performanceRating     Int?      @map("performance_rating") // 1-5
  onTrack               Boolean   @map("on_track")

  // Observations
  positiveObservations  String[]  @default([]) @map("positive_observations")
  concernsRaised        String[]  @default([]) @map("concerns_raised")
  behaviorChanges       String?   @map("behavior_changes") @db.Text

  // Feedback
  managerFeedback       String    @map("manager_feedback") @db.Text
  employeeFeedback      String?   @map("employee_feedback") @db.Text

  // Actions
  actionItems           Json      @default("[]") @map("action_items")
  adjustmentsMade       String?   @map("adjustments_made") @db.Text
  nextSteps             String[]  @default([]) @map("next_steps")

  // Documentation
  attendees             String[]  @default([]) @map("attendees") @db.Uuid
  documentationUrl      String?   @map("documentation_url")

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  pip                   PerformanceImprovementPlan @relation(fields: [pipId], references: [id], onDelete: Cascade)
  user                  User      @relation("UserPIPCheckIns", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, pipId])
  @@index([checkInDate])
  @@map("pip_check_ins")
}

model PIPMilestone {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  pipId                 String    @map("pip_id") @db.Uuid

  // Milestone Details
  milestoneName         String    @map("milestone_name")
  description           String    @map("description") @db.Text
  dueDate               DateTime  @map("due_date")

  // Success Criteria
  successCriteria       Json      @default("[]") @map("success_criteria")
  measurableTargets     Json      @default("{}") @map("measurable_targets")

  // Status
  status                String    @default("NOT_STARTED") @map("status") // NOT_STARTED, IN_PROGRESS, COMPLETED, FAILED
  completionDate        DateTime? @map("completion_date")
  achievementLevel      String?   @map("achievement_level") // EXCEEDED, MET, PARTIALLY_MET, NOT_MET

  // Evaluation
  evaluationNotes       String?   @map("evaluation_notes") @db.Text
  evidenceProvided      Json?     @map("evidence_provided")

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  pip                   PerformanceImprovementPlan @relation(fields: [pipId], references: [id], onDelete: Cascade)

  @@index([tenantId, pipId])
  @@index([dueDate])
  @@map("pip_milestones")
}

model PIPTemplate {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid

  // Template Details
  templateName          String    @map("template_name")
  pipType               String    @map("pip_type") // PERFORMANCE, BEHAVIOR, ATTENDANCE, SKILLS
  description           String?   @map("description") @db.Text

  // Template Content
  templateContent       Json      @default("{}") @map("template_content")
  defaultDuration       Int       @default(90) @map("default_duration") // days
  defaultGoals          Json      @default("[]") @map("default_goals")
  defaultMilestones     Json      @default("[]") @map("default_milestones")
  defaultSupport        Json      @default("[]") @map("default_support")

  // Usage
  isActive              Boolean   @default(true) @map("is_active")
  usageCount            Int       @default(0) @map("usage_count")

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([pipType])
  @@map("pip_templates")
}

// Feature 50: Organizational Health & Culture Diagnostics
model OrganizationalHealthMetrics {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid

  // Time Period
  metricDate            DateTime  @map("metric_date")
  period                String    @map("period") // WEEKLY, MONTHLY, QUARTERLY, ANNUAL
  periodStart           DateTime  @map("period_start")
  periodEnd             DateTime  @map("period_end")

  // Overall Health Score
  overallHealthScore    Decimal   @map("overall_health_score") @db.Decimal(5, 2)
  healthLevel           String    @map("health_level") // EXCELLENT, GOOD, FAIR, POOR, CRITICAL
  trendDirection        String?   @map("trend_direction") // IMPROVING, STABLE, DECLINING

  // Component Scores
  engagementScore       Decimal   @map("engagement_score") @db.Decimal(5, 2)
  performanceScore      Decimal   @map("performance_score") @db.Decimal(5, 2)
  cultureScore          Decimal   @map("culture_score") @db.Decimal(5, 2)
  leadershipScore       Decimal   @map("leadership_score") @db.Decimal(5, 2)
  collaborationScore    Decimal   @map("collaboration_score") @db.Decimal(5, 2)
  innovationScore       Decimal   @map("innovation_score") @db.Decimal(5, 2)
  wellbeingScore        Decimal   @map("wellbeing_score") @db.Decimal(5, 2)

  // People Metrics
  headcount             Int       @map("headcount")
  activeEmployees       Int       @map("active_employees")
  newHires              Int       @default(0) @map("new_hires")
  terminations          Int       @default(0) @map("terminations")
  turnoverRate          Decimal   @map("turnover_rate") @db.Decimal(5, 2)
  retentionRate         Decimal   @map("retention_rate") @db.Decimal(5, 2)

  // Engagement Metrics
  avgEngagementScore    Decimal   @map("avg_engagement_score") @db.Decimal(5, 2)
  employeeSatisfaction  Decimal?  @map("employee_satisfaction") @db.Decimal(5, 2)
  eNPS                  Decimal?  @map("enps") @db.Decimal(6, 2) // Employee Net Promoter Score
  participationRate     Decimal?  @map("participation_rate") @db.Decimal(5, 2)

  // Performance Metrics
  avgPerformanceRating  Decimal   @map("avg_performance_rating") @db.Decimal(3, 2)
  highPerformers        Int       @map("high_performers")
  lowPerformers         Int       @map("low_performers")
  goalCompletionRate    Decimal   @map("goal_completion_rate") @db.Decimal(5, 2)

  // Development Metrics
  employeesInDevelopment Int      @default(0) @map("employees_in_development")
  avgDevelopmentHours   Decimal?  @map("avg_development_hours") @db.Decimal(6, 2)
  certificationRate     Decimal?  @map("certification_rate") @db.Decimal(5, 2)
  promotionRate         Decimal?  @map("promotion_rate") @db.Decimal(5, 2)

  // Risk Indicators
  atRiskEmployees       Int       @default(0) @map("at_risk_employees")
  burnoutRiskCount      Int       @default(0) @map("burnout_risk_count")
  disengagementRisk     Int       @default(0) @map("disengagement_risk_count")
  flightRiskCount       Int       @default(0) @map("flight_risk_count")

  // Diversity Metrics
  diversityMetrics      Json      @default("{}") @map("diversity_metrics")
  inclusionScore        Decimal?  @map("inclusion_score") @db.Decimal(5, 2)

  // Sentiment Metrics
  avgSentimentScore     Decimal?  @map("avg_sentiment_score") @db.Decimal(4, 3)
  positiveSentiment     Decimal?  @map("positive_sentiment") @db.Decimal(5, 2)
  negativeSentiment     Decimal?  @map("negative_sentiment") @db.Decimal(5, 2)

  // Calculated Insights
  strengths             String[]  @default([]) @map("strengths")
  concerns              String[]  @default([]) @map("concerns")
  recommendations       Json      @default("[]") @map("recommendations")

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  departmentMetrics     DepartmentHealthMetrics[]

  @@unique([tenantId, metricDate, period])
  @@index([tenantId])
  @@index([metricDate])
  @@index([healthLevel])
  @@map("organizational_health_metrics")
}

model DepartmentHealthMetrics {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  orgHealthMetricsId    String    @map("org_health_metrics_id") @db.Uuid
  departmentId          String    @map("department_id") @db.Uuid

  // Scores
  healthScore           Decimal   @map("health_score") @db.Decimal(5, 2)
  engagementScore       Decimal   @map("engagement_score") @db.Decimal(5, 2)
  performanceScore      Decimal   @map("performance_score") @db.Decimal(5, 2)

  // Metrics
  headcount             Int       @map("headcount")
  turnoverRate          Decimal   @map("turnover_rate") @db.Decimal(5, 2)
  avgPerformance        Decimal   @map("avg_performance") @db.Decimal(5, 2)

  // Comparison
  vsOrgAverage          Decimal   @map("vs_org_average") @db.Decimal(6, 2)
  ranking               Int?      @map("ranking")

  createdAt             DateTime  @default(now()) @map("created_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  orgHealthMetrics      OrganizationalHealthMetrics @relation(fields: [orgHealthMetricsId], references: [id], onDelete: Cascade)
  department            Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  @@index([tenantId, departmentId])
  @@index([orgHealthMetricsId])
  @@map("department_health_metrics")
}

model CultureDiagnostic {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid

  // Diagnostic Details
  diagnosticDate        DateTime  @map("diagnostic_date")
  diagnosticType        String    @map("diagnostic_type") // COMPREHENSIVE, TARGETED, PULSE

  // Culture Dimensions (Competing Values Framework)
  clanCulture           Decimal   @map("clan_culture") @db.Decimal(5, 2) // Collaborate
  adhocracyCulture      Decimal   @map("adhocracy_culture") @db.Decimal(5, 2) // Create
  marketCulture         Decimal   @map("market_culture") @db.Decimal(5, 2) // Compete
  hierarchyCulture      Decimal   @map("hierarchy_culture") @db.Decimal(5, 2) // Control

  // Culture Attributes
  psychologicalSafety   Decimal   @map("psychological_safety") @db.Decimal(5, 2)
  trustLevel            Decimal   @map("trust_level") @db.Decimal(5, 2)
  autonomy              Decimal   @map("autonomy") @db.Decimal(5, 2)
  transparency          Decimal   @map("transparency") @db.Decimal(5, 2)
  accountability        Decimal   @map("accountability") @db.Decimal(5, 2)
  innovation            Decimal   @map("innovation") @db.Decimal(5, 2)
  customerFocus         Decimal   @map("customer_focus") @db.Decimal(5, 2)
  resultsOrientation    Decimal   @map("results_orientation") @db.Decimal(5, 2)

  // Values Alignment
  valuesAlignment       Decimal   @map("values_alignment") @db.Decimal(5, 2)
  missionClarity        Decimal   @map("mission_clarity") @db.Decimal(5, 2)
  visionAlignment       Decimal   @map("vision_alignment") @db.Decimal(5, 2)

  // Culture Gaps
  desiredCulture        Json      @default("{}") @map("desired_culture")
  currentCulture        Json      @default("{}") @map("current_culture")
  cultureGaps           Json      @default("[]") @map("culture_gaps")
  gapPriority           Json      @default("[]") @map("gap_priority")

  // Analysis
  culturalStrengths     String[]  @default([]) @map("cultural_strengths")
  culturalWeaknesses    String[]  @default([]) @map("cultural_weaknesses")
  subcultures           Json      @default("[]") @map("subcultures")
  culturalRisks         String[]  @default([]) @map("cultural_risks")

  // Recommendations
  recommendations       Json      @default("[]") @map("recommendations")
  actionPlan            Json      @default("[]") @map("action_plan")

  // Data Sources
  surveyResponses       Int       @default(0) @map("survey_responses")
  focusGroupsConducted  Int       @default(0) @map("focus_groups_conducted")
  dataQualityScore      Decimal?  @map("data_quality_score") @db.Decimal(3, 2)

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([diagnosticDate])
  @@map("culture_diagnostics")
}

model ScenarioAnalysis {
  id                    String    @id @default(uuid()) @db.Uuid
  tenantId              String    @map("tenant_id") @db.Uuid
  createdBy             String    @map("created_by") @db.Uuid

  // Scenario Definition
  scenarioName          String    @map("scenario_name")
  scenarioType          String    @map("scenario_type") // GROWTH, REDUCTION, RESTRUCTURE, MERGER, TECHNOLOGY_CHANGE
  description           String    @map("description") @db.Text

  // Parameters
  parameters            Json      @default("{}") @map("parameters")
  assumptions           Json      @default("[]") @map("assumptions")
  timeframe             String    @map("timeframe") // 6_MONTHS, 1_YEAR, 2_YEARS, 3_YEARS

  // Changes Modeled
  headcountChanges      Json      @default("{}") @map("headcount_changes")
  structuralChanges     Json      @default("[]") @map("structural_changes")
  budgetChanges         Json      @default("{}") @map("budget_changes")

  // Projected Outcomes
  projectedMetrics      Json      @default("{}") @map("projected_metrics")
  financialImpact       Json      @default("{}") @map("financial_impact")
  peopleImpact          Json      @default("{}") @map("people_impact")
  culturalImpact        String?   @map("cultural_impact") @db.Text

  // Risk Assessment
  risks                 Json      @default("[]") @map("risks")
  riskMitigation        Json      @default("[]") @map("risk_mitigation")
  probabilityOfSuccess  Decimal?  @map("probability_of_success") @db.Decimal(3, 2)

  // Comparison
  comparisonToBaseline  Json      @default("{}") @map("comparison_to_baseline")
  alternativeScenarios  String[]  @default([]) @map("alternative_scenarios") @db.Uuid

  // Recommendations
  recommendations       Json      @default("[]") @map("recommendations")
  implementationPlan    Json?     @map("implementation_plan")

  // Status
  status                String    @default("DRAFT") @map("status") // DRAFT, UNDER_REVIEW, APPROVED, ARCHIVED
  sharedWith            String[]  @default([]) @map("shared_with") @db.Uuid

  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relations
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([scenarioType])
  @@index([status])
  @@map("scenario_analyses")
}
